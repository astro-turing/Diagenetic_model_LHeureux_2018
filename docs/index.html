<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Johan Hidding" />
  <title>L’Heureux Fortran model</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="theme.css" />
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">L’Heureux Fortran model</h1>
<p class="subtitle">total decomposition of a Fortran code</p>
<p class="author">Johan Hidding</p>
<!--        <div id="dark-mode-toggle">
                <p>Dark mode: <button class="dark-mode-button"
                        aria-label="Toggle dark mode"
                        onclick="toggle_dark_mode()">
                        <span></span><span></span>
                </button></p>
</div> -->
</header>
<div class="row">
        <div class="col-6 col-s-9" id="main">
<section id="main" class="level1">
<h1>Main</h1>
<p>The <code>COMMON</code> blocks in fortran create a kind of global variables. Here they’re used to store the free parameters of the model. The array <code>P(35)</code> is used to store all input parameters and are used throughout.</p>
<div class="named-code-block">
<p>«main-declare-variables»</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode fortran"><code class="sourceCode fortranfixed"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dt">REAL*8</span> pho(<span class="dv">0</span>:<span class="dv">1000</span>),cao(<span class="dv">0</span>:<span class="dv">1000</span>),coo(<span class="dv">0</span>:<span class="dv">1000</span>),ARAo(<span class="dv">0</span>:<span class="dv">1000</span>),CALo(<span class="dv">0</span>:<span class="dv">1000</span>),ph(<span class="co">0:1000)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="dt">REAL*8</span> ca(<span class="dv">0</span>:<span class="dv">1000</span>),co(<span class="dv">0</span>:<span class="dv">1000</span>),ARA(<span class="dv">0</span>:<span class="dv">1000</span>),CAL(<span class="dv">0</span>:<span class="dv">1000</span>),U(<span class="dv">0</span>:<span class="dv">1000</span>),W(<span class="dv">0</span>:<span class="dv">1000</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="dt">REAL*8</span> phalf(<span class="dv">0</span>:<span class="dv">1000</span>),ARAhalf(<span class="dv">0</span>:<span class="dv">1000</span>),CALhalf(<span class="dv">0</span>:<span class="dv">1000</span>),cahalf(<span class="dv">0</span>:<span class="dv">1000</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="dt">REAL*8</span> cohalf(<span class="dv">0</span>:<span class="dv">1000</span>),whalf(<span class="dv">0</span>:<span class="dv">1000</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="dt">REAL*8</span> Rca(<span class="dv">0</span>:<span class="dv">1000</span>),Rco(<span class="dv">0</span>:<span class="dv">1000</span>),RAR(<span class="dv">0</span>:<span class="dv">1000</span>),RCAL(<span class="dv">0</span>:<span class="dv">1000</span>),RARdum(<span class="dv">0</span>:<span class="dv">1000</span>),RCALdum(<span class="dv">0</span>:<span class="dv">1000</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="dt">REAL*8</span> OC(<span class="dv">0</span>:<span class="dv">1000</span>),OA(<span class="dv">0</span>:<span class="dv">1000</span>),t,dt,dx,P(<span class="dv">35</span>),dca(<span class="dv">0</span>:<span class="dv">1000</span>),dco(<span class="dv">0</span>:<span class="dv">1000</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="dt">REAL*8</span> sigca(<span class="dv">0</span>:<span class="dv">1000</span>),sigco(<span class="dv">0</span>:<span class="dv">1000</span>),Rp(<span class="dv">0</span>:<span class="dv">1000</span>),te,wap,S(<span class="dv">0</span>:<span class="dv">1000</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="dt">REAL*8</span> Sdum(<span class="dv">0</span>:<span class="dv">1000</span>),Udum(<span class="dv">0</span>:<span class="dv">1000</span>),sigpo(<span class="dv">0</span>:<span class="dv">1000</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="dt">INTEGER</span> tmax,j,outx,i,N,outt</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">COMMON/general/ pho,cao,coo,ARAo,CALo,tmax,outx,outt,N</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">COMMON/par/P</span></span></code></pre></div>
</div>
<section id="parameters-p35" class="level2">
<h2>Parameters <code>P(35)</code></h2>
<div class="table">
<table>
<colgroup>
<col style="width: 40%" />
<col style="width: 30%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Number</th>
<th>Symbol</th>
<th>Remarks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td><span class="math inline">\(m\)</span></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td><span class="math inline">\(n\)</span></td>
<td></td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td><span class="math inline">\(\lambda\)</span></td>
<td><span class="math inline">\(k_3 / k_2\)</span></td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td><span class="math inline">\(\nu_1\)</span></td>
<td><span class="math inline">\(k_1 / k_2\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td><span class="math inline">\(d_{\rm Ar}\)</span></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td><span class="math inline">\(\delta\)</span></td>
<td></td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td></td>
<td><span class="math inline">\(\rho_s c_{\rm Cal}^0 / \rho_c\)</span>, or <span class="math inline">\(c^0_{\rm Cal}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td><span class="math inline">\(\phi_0\)</span></td>
<td></td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td></td>
<td><span class="math inline">\(1 - \rho_t / \rho_c\)</span> or <span class="math inline">\(0\)</span></td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td></td>
<td><span class="math inline">\(1 - \rho_t / \rho_a\)</span> or <span class="math inline">\(0\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: right;">11</td>
<td></td>
<td><span class="math inline">\(\rho_t / \rho_w\)</span> or <span class="math inline">\(\rho_s^0 / \rho_w\)</span></td>
</tr>
<tr class="even">
<td style="text-align: right;">12</td>
<td></td>
<td><span class="math inline">\(\rho_c / \rho_w\)</span> or <span class="math inline">\(\rho_s^0 / \rho_w\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: right;">13</td>
<td></td>
<td><span class="math inline">\(\rho_s^0/\rho_w - 1\)</span></td>
</tr>
<tr class="even">
<td style="text-align: right;">14</td>
<td><span class="math inline">\(T_h\)</span></td>
<td>Something set to 100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15</td>
<td><span class="math inline">\(\Delta t\)</span></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: right;">16</td>
<td><span class="math inline">\(\Delta x\)</span></td>
<td></td>
</tr>
<tr class="odd">
<td style="text-align: right;">17</td>
<td></td>
<td><span class="math inline">\(1 - C_A^0 - C_C^0\)</span></td>
</tr>
<tr class="even">
<td style="text-align: right;">18</td>
<td><span class="math inline">\(C_A^0\)</span></td>
<td></td>
</tr>
<tr class="odd">
<td style="text-align: right;">19</td>
<td><span class="math inline">\(C_C^0\)</span></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: right;">20</td>
<td></td>
<td><span class="math inline">\(\rho_s^0 / \rho_w\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: right;">21</td>
<td></td>
<td><span class="math inline">\(a / X^*\)</span></td>
</tr>
<tr class="even">
<td style="text-align: right;">22</td>
<td></td>
<td><span class="math inline">\(x_d / X^*\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: right;">23</td>
<td></td>
<td><span class="math inline">\(S / V_{\rm scale}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: right;">24</td>
<td></td>
<td><span class="math inline">\(K_C / K_A\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: right;">25</td>
<td></td>
<td><span class="math inline">\(D^0_{\rm CO3} / D^0_{\rm Ca}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: right;">26</td>
<td></td>
<td><span class="math inline">\(k_2 T^*\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: right;">27</td>
<td></td>
<td><span class="math inline">\(\rho_c / \rho_a\)</span> or <span class="math inline">\(1\)</span></td>
</tr>
<tr class="even">
<td style="text-align: right;">28</td>
<td></td>
<td><span class="math inline">\(b / X^*\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: right;">29</td>
<td><span class="math inline">\(\epsilon\)</span></td>
<td>Some small number</td>
</tr>
<tr class="even">
<td style="text-align: right;">30</td>
<td></td>
<td><code>xcem/Xs</code>???</td>
</tr>
<tr class="odd">
<td style="text-align: right;">31</td>
<td></td>
<td><code>xcemf/Xs</code>???</td>
</tr>
<tr class="even">
<td style="text-align: right;">32</td>
<td></td>
<td><span class="math inline">\(\beta / V_{\rm scale}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: right;">33</td>
<td></td>
<td><span class="math inline">\(1/(c_{\rm Athy}X^*)\)</span></td>
</tr>
<tr class="even">
<td style="text-align: right;">34</td>
<td><span class="math inline">\(\phi_{\infty}\)</span></td>
<td></td>
</tr>
<tr class="odd">
<td style="text-align: right;">35</td>
<td><span class="math inline">\({\rm difpor}\)</span></td>
<td><span class="math inline">\(\beta \phi_0^3 / ((\phi_0 - \phi_{\infty})c_{\rm Athy}D^0_{\rm Ca})\)</span></td>
</tr>
</tbody>
</table>
</div>
<div class="named-code-block">
<p>«main-call-auxf»</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode fortran"><code class="sourceCode fortranfixed"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">call auxf(t,n,ph,ca,co,ARA,CAL,U,S,W,OC,OA,dca,dco,sigpo,sigca,sigco,Rp,Rca,Rco,RAR,RCAL)</span></span></code></pre></div>
</div>
</section>
<section id="integration" class="level2">
<h2>Integration</h2>
<div class="named-code-block">
<p>«time-integration»</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode fortran"><code class="sourceCode fortranfixed"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">call projectX(n,ARA,CAL,U,S,RAR,RCAL,ARAhalf,CALhalf)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">call projectY(n,ph,ca,co,W,dca,dco,sigpo,sigca,sigco,Rp,Rca,Rco,phalf,cahalf,cohalf)</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">do</span> j<span class="kw">=</span><span class="dv">1</span>,tmax</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;&lt;</span><span class="bu">log</span><span class="kw">-</span>progress<span class="op">&gt;&gt;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">call</span> auxf(t,n,phalf,cahalf,cohalf,ARAhalf,CALhalf,Udum,Sdum,Whalf,OC<span class="co">,OA,dca,dco,sigpo,sigca,sigco,Rp,Rca,Rco,RARdum,RCALdum)   </span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">call</span> CRANK(t,n,ph,ca,co,Whalf,dca,dco,sigpo,sigca,sigco,Rp,Rca,Rco,phalf)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">call</span> upwind(n,ARA,CAL,U,S,RAR,RCAL)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    t<span class="kw">=</span>t<span class="kw">+</span>dt</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">call</span> auxf(t,n,ph,ca,co,ARA,CAL,U,S,W,OC,OA,dca,dco,sigpo,sigca,sigco<span class="co">,Rp,Rca,Rco,RAR,RCAL)</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;&lt;</span><span class="fu">write</span><span class="kw">-</span>output<span class="op">&gt;&gt;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">call</span> projectX(n,ARA,CAL,U,S,RAR,RCAL,ARAhalf,CALhalf)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">call</span> projectY(n,ph,ca,co,W,dca,dco,sigpo,sigca,sigco,Rp,Rca,Rco,phalf,cahalf,cohalf)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end do</span></span></code></pre></div>
</div>
<p>Notice, the first call to <code>auxf</code> we use all the <code>/.*half/</code> entities. Information is written to several dummy variables that are not used and <code>Whalf</code>, <code>dca</code>, and <code>dco</code>, the signs and the reaction terms. The second call to <code>auxf</code> (after Crank-Nicolson and Upwind integration), the true parameters are updated.</p>
<div class="named-code-block">
<p>file:src/patched.f90</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode fortran"><code class="sourceCode fortranfixed"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">!     Last change:  IL   19 Mar 2014    5:25 pm</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">!  Rythmite limestone/marl - semiimplicit diffusion on c,po and explicit advection on M with upwind scheme</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">!  Main code</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>       <span class="kw">program</span> marl_PDE</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>           <span class="kw">implicit</span> <span class="kw">none</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>           <span class="op">&lt;&lt;</span>main<span class="kw">-</span>declare<span class="kw">-</span>variables<span class="op">&gt;&gt;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>           <span class="op">&lt;&lt;</span>main<span class="kw">-</span><span class="fu">open</span><span class="kw">-</span>output<span class="kw">-</span>files<span class="op">&gt;&gt;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>           <span class="op">&lt;&lt;</span>main<span class="kw">-</span>initialize<span class="op">&gt;&gt;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>           <span class="op">&lt;&lt;</span>main<span class="kw">-</span><span class="fu">write</span><span class="op">&gt;&gt;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>           <span class="op">&lt;&lt;</span>main<span class="kw">-call-</span>auxf<span class="op">&gt;&gt;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>           <span class="op">&lt;&lt;</span>main<span class="kw">-</span><span class="fu">write</span><span class="kw">-</span>again<span class="op">&gt;&gt;</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>           wap<span class="kw">=</span>w(<span class="dv">0</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>           wap<span class="kw">=</span>wap    </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>           <span class="op">&lt;&lt;</span>time<span class="kw">-</span>integration<span class="op">&gt;&gt;</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="dv">100</span>        <span class="fu">format (</span>23<span class="fu">(</span>d12.5,1x<span class="fu">))</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="dv">101</span>        <span class="fu">format (</span>13x,23<span class="fu">(</span>a2,11x<span class="fu">))</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="dv">102</span>        <span class="fu">format (</span>12<span class="fu">(</span>d12.5,1x<span class="fu">))</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="dv">103</span>        <span class="fu">FORMAT(</span>13x,12<span class="fu">(</span>a2,11x<span class="fu">))</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="dv">110</span>        <span class="fu">format(</span>13x,10<span class="fu">(</span>a2,11x<span class="fu">))</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>           <span class="fu">close (</span><span class="dv">8</span><span class="fu">)</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>           <span class="fu">CLOSE(</span><span class="dv">9</span><span class="fu">)</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>           <span class="fu">CLOSE(</span><span class="dv">10</span><span class="fu">)</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>           <span class="fu">CLOSE(</span><span class="dv">11</span><span class="fu">)</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>           <span class="fu">CLOSE(</span><span class="dv">12</span><span class="fu">)</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>           <span class="fu">CLOSE(</span><span class="dv">13</span><span class="fu">)</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>           <span class="fu">write (</span><span class="dv">6</span>,<span class="fu">*)</span> <span class="st">&#39;fini&#39;</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>           <span class="kw">stop</span> <span class="st">&#39;marl&#39;</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>       <span class="kw">end program</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>auxf<span class="op">&gt;&gt;</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>upwind<span class="op">&gt;&gt;</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>project<span class="kw">-</span>x<span class="op">&gt;&gt;</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>project<span class="kw">-</span>y<span class="op">&gt;&gt;</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>crank<span class="kw">-</span>nicolson<span class="op">&gt;&gt;</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>init<span class="op">&gt;&gt;</span></span></code></pre></div>
</div>
</section>
</section>
<section id="auxiliary-functions" class="level1">
<h1>Auxiliary functions</h1>
<div class="named-code-block">
<p>«auxf»</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode fortran"><code class="sourceCode fortranfixed"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>           <span class="kw">subroutine</span> auxf(t,n,ph,ca,co,ARA,CAL,U,S,W,OC,OA,dca,dco,sigpo,sigca,sigco,Rp,Rca,Rco,RAR,RCAL)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">! This routine calculates all auxiliairy functions: Peclet numbers, oversaturations, reaction rates and others</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>           <span class="kw">implicit</span> <span class="kw">none</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>               <span class="dt">real*8</span> P(<span class="dv">35</span>),ph(<span class="dv">0</span>:<span class="dv">1000</span>),ca(<span class="dv">0</span>:<span class="dv">1000</span>),co(<span class="dv">0</span>:<span class="dv">1000</span>),ARA(<span class="dv">0</span>:<span class="dv">1000</span>)<span class="co">,CAL(0:1000),U(0:1000),W(0:1000)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>           <span class="dt">real</span> <span class="kw">*</span><span class="dv">8</span> OC(<span class="dv">0</span>:<span class="dv">1000</span>),OA(<span class="dv">0</span>:<span class="dv">1000</span>),k(<span class="dv">0</span>:<span class="dv">1000</span>),dca(<span class="dv">0</span>:<span class="dv">1000</span>),dco(<span class="dv">0</span>:<span class="dv">1000</span>),sigca(<span class="dv">0</span>:<span class="dv">1000</span>),sigco(<span class="dv">0</span>:<span class="dv">1000</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>           <span class="dt">REAL*8</span> Rp(<span class="dv">0</span>:<span class="dv">1000</span>),betasV,S(<span class="dv">0</span>:<span class="dv">1000</span>),sigpo(<span class="dv">0</span>:<span class="dv">1000</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>           <span class="dt">REAL*8</span> Rca(<span class="dv">0</span>:<span class="dv">1000</span>),Rco(<span class="dv">0</span>:<span class="dv">1000</span>),RAR(<span class="dv">0</span>:<span class="dv">1000</span>),RCAL(<span class="dv">0</span>:<span class="dv">1000</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>           <span class="dt">REAL*8</span> Pe1,Pe2,Pe3,sc,sa,t,rhosw0,F</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>           <span class="dt">real*8</span> dpdx,dx</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">!           real*8 xpeak,xwidth,dx</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>              <span class="dt">integer</span> icem,icemf</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>          <span class="dt">integer</span> idis,idisf</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>          <span class="dt">integer</span> i,n</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>              <span class="kw">COMMON/</span>par<span class="kw">/</span>P </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>          dx<span class="kw">=</span>P(<span class="dv">16</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a> <span class="co">!         eps=P(29)</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>          t<span class="kw">=</span>t </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>          rhosw0<span class="kw">=</span>P(<span class="dv">20</span>)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co">!           dx=P(16)</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co">!            xpeak=P(22)+0.5*P(14)</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co">!           xwidth=0.5*P(14)</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>            idis<span class="kw">=</span><span class="bu">NINT</span>(P(<span class="dv">22</span>)<span class="kw">/</span>P(<span class="dv">16</span>))</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>            idisf<span class="kw">=</span><span class="bu">NINT</span>((P(<span class="dv">22</span>)<span class="kw">+</span>P(<span class="dv">14</span>))<span class="kw">/</span>P(<span class="dv">16</span>))</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>            icem<span class="kw">=</span><span class="bu">NINT</span>(P(<span class="dv">30</span>)<span class="kw">/</span>P(<span class="dv">16</span>))</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>            icemf<span class="kw">=</span><span class="bu">NINT</span>(P(<span class="dv">31</span>)<span class="kw">/</span>P(<span class="dv">16</span>))</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a> <span class="co">!           idisf=idisf+1</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a> <span class="co">!           Ko=phi0**3*(1-dexp(-10.*(1-phi0)/phi0))/(1-phi0)**2</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>             betasV<span class="kw">=</span>P(<span class="dv">32</span>)         </span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co">!    i = 0 </span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="co">!  In fact, k is actually k*(1-ph)                </span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>                    u(<span class="dv">0</span>)<span class="kw">=</span>P(<span class="dv">23</span>)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>                    S(<span class="dv">0</span>)<span class="kw">=</span><span class="fl">1.</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>                    k(<span class="dv">0</span>)<span class="kw">=</span>ph(<span class="dv">0</span>)<span class="kw">**</span><span class="dv">3</span><span class="kw">*</span>betasV<span class="kw">/</span>(<span class="dv">1</span><span class="kw">-</span>ph(<span class="dv">0</span>))</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>                    k(<span class="dv">0</span>)<span class="kw">=</span>k(<span class="dv">0</span>)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span><span class="bu">dexp</span>(<span class="kw">-</span><span class="fl">10.d0</span><span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>ph(<span class="dv">0</span>))<span class="kw">/</span>ph(<span class="dv">0</span>)))</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>                    dpdx<span class="kw">=</span>(ph(<span class="dv">1</span>)<span class="kw">-</span>ph(<span class="dv">0</span>))<span class="kw">/</span>dx</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>                    dpdx<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>                    dpdx<span class="kw">=</span>dpdx</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>                    w(<span class="dv">0</span>)<span class="kw">=</span>u(<span class="dv">0</span>)<span class="kw">-</span>k(<span class="dv">0</span>)<span class="kw">*</span>(rhosw0<span class="kw">-</span><span class="dv">1</span>)<span class="kw">/</span>ph(<span class="dv">0</span>)</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a> <span class="co">!                   w(0)=u(0)-k(0)*(rhosw0-1)/ph(0)*(1+dpdx*P(33)/(ph(0)-P(34)))</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a> <span class="co">!                   </span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a> <span class="co">!                                    </span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>                OA(<span class="dv">0</span>)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>                 sa<span class="kw">=</span><span class="dv">1</span><span class="kw">-</span>ca(<span class="dv">0</span>)<span class="kw">*</span>co(<span class="dv">0</span>)<span class="kw">*</span>P(<span class="dv">24</span>)</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>                 sc<span class="kw">=</span>ca(<span class="dv">0</span>)<span class="kw">*</span>co(<span class="dv">0</span>)<span class="kw">-</span><span class="fl">1.</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a><span class="co">!                 F=dexp(-(xpeak)**2/(2*xwidth**2))</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>                F<span class="kw">=</span><span class="fl">1.d0</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>                <span class="kw">IF</span>( (<span class="dv">0</span><span class="op">.gt.</span>idis)<span class="op">.and.</span> (<span class="dv">0</span><span class="op">.lt.</span>idisf)) <span class="kw">then</span>                         </span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>                   <span class="kw">if</span> (sa<span class="op">.gt.</span><span class="fl">0.</span>) <span class="kw">then</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>                         OA(<span class="dv">0</span>)<span class="kw">=</span>F<span class="kw">*</span>sa<span class="kw">**</span>P(<span class="dv">1</span>)</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>                   <span class="kw">else</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>                         OA(<span class="dv">0</span>)<span class="kw">=-</span>F<span class="kw">*</span>(<span class="kw">-</span>sa)<span class="kw">**</span>P(<span class="dv">1</span>)</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>                         OA(<span class="dv">0</span>)<span class="kw">=</span><span class="fl">0.</span> </span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>                   <span class="kw">endif</span>           </span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>                <span class="kw">endif</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>                <span class="kw">IF</span>( (<span class="dv">0</span><span class="op">.eq.</span>idis)<span class="op">.or.</span> (<span class="dv">0</span><span class="op">.eq.</span>idisf)) <span class="kw">then</span>                </span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>                   <span class="kw">if</span> (sa<span class="op">.gt.</span><span class="fl">0.</span>) <span class="kw">then</span> </span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>                       OA(<span class="dv">0</span>)<span class="kw">=</span>sa<span class="kw">**</span>P(<span class="dv">1</span>)</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">else</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>                      OA(<span class="dv">0</span>)<span class="kw">=-</span>(<span class="kw">-</span>sa)<span class="kw">**</span>P(<span class="dv">1</span>)</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>                      OA(<span class="dv">0</span>)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">endif</span>      </span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>                <span class="kw">endif</span></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>                <span class="kw">IF</span>( (<span class="dv">0</span><span class="op">.lt.</span>idis)<span class="op">.or.</span> (<span class="dv">0</span><span class="op">.gt.</span>idisf)) <span class="kw">then</span> </span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>                   <span class="kw">if</span> (sa<span class="op">.gt.</span><span class="fl">0.</span>) <span class="kw">then</span> </span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>                       OA(<span class="dv">0</span>)<span class="kw">=</span><span class="fl">0.d0</span></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">else</span></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>                       OA(<span class="dv">0</span>)<span class="kw">=-</span>(<span class="kw">-</span>sa)<span class="kw">**</span>P(<span class="dv">1</span>)</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>                       OA(<span class="dv">0</span>)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">endif</span>      </span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>                <span class="kw">endif</span>       </span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>              <span class="kw">if</span>((<span class="dv">0</span><span class="op">.gt.</span>icem)<span class="op">.and.</span>(<span class="dv">0</span><span class="op">.lt.</span>icemf)) <span class="kw">then</span>               </span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> (sc<span class="op">.gt.</span><span class="fl">0.</span>) <span class="kw">then</span></span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>                           OC(<span class="dv">0</span>)<span class="kw">=</span>sc<span class="kw">**</span>P(<span class="dv">2</span>)</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>                 <span class="kw">else</span></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>                           OC(<span class="dv">0</span>)<span class="kw">=-</span>(<span class="kw">-</span>sc)<span class="kw">**</span>P(<span class="dv">2</span>)</span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>                           OC(<span class="dv">0</span>)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>                 <span class="kw">end if</span></span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>              <span class="kw">endif</span></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>              <span class="kw">if</span>((<span class="dv">0</span><span class="op">.eq.</span>icem)<span class="op">.or.</span>(<span class="dv">0</span><span class="op">.eq.</span>icemf)) <span class="kw">then</span>               </span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> (sc<span class="op">.gt.</span><span class="fl">0.</span>) <span class="kw">then</span></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>                           OC(<span class="dv">0</span>)<span class="kw">=</span>sc<span class="kw">**</span>P(<span class="dv">2</span>)</span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>                 <span class="kw">else</span></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>                           OC(<span class="dv">0</span>)<span class="kw">=-</span>(<span class="kw">-</span>sc)<span class="kw">**</span>P(<span class="dv">2</span>)</span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>                           OC(<span class="dv">0</span>)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>                 <span class="kw">end if</span></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>              <span class="kw">endif</span> </span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>              <span class="kw">if</span>((<span class="dv">0</span><span class="op">.lt.</span>icem)<span class="op">.or.</span>(<span class="dv">0</span><span class="op">.gt.</span>icemf)) <span class="kw">then</span>               </span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> (sc<span class="op">.gt.</span><span class="fl">0.</span>) <span class="kw">then</span></span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>                           OC(<span class="dv">0</span>)<span class="kw">=</span><span class="fl">0.d0</span></span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>                 <span class="kw">else</span></span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>                           OC(<span class="dv">0</span>)<span class="kw">=-</span>(<span class="kw">-</span>sc)<span class="kw">**</span>P(<span class="dv">2</span>)</span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>                           OC(<span class="dv">0</span>)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>                 <span class="kw">end if</span></span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>              <span class="kw">endif</span>         </span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>                       dca(<span class="dv">0</span>)<span class="kw">=</span><span class="fl">1.</span><span class="kw">/</span>(<span class="dv">1</span><span class="kw">-</span><span class="dv">2</span><span class="kw">*</span><span class="bu">dlog</span>(ph(<span class="dv">0</span>)))</span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>                       dco(<span class="dv">0</span>)<span class="kw">=</span>dca(<span class="dv">0</span>)<span class="kw">*</span>P(<span class="dv">25</span>)</span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>           Rca(<span class="dv">0</span>)<span class="kw">=</span>P(<span class="dv">26</span>)<span class="kw">*</span>(P(<span class="dv">6</span>)<span class="kw">/</span>P(<span class="dv">7</span>)<span class="kw">-</span>ca(<span class="dv">0</span>))<span class="kw">*</span>(OA(<span class="dv">0</span>)<span class="kw">*</span>ARA(<span class="dv">0</span>)<span class="kw">-</span>P(<span class="dv">3</span>)<span class="kw">*</span>OC(<span class="dv">0</span>)<span class="kw">*</span>CAL(<span class="dv">0</span><span class="co">))*(1-ph(0))/ph(0) </span></span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>           Rco(<span class="dv">0</span>)<span class="kw">=</span>P(<span class="dv">26</span>)<span class="kw">*</span>(P(<span class="dv">6</span>)<span class="kw">/</span>P(<span class="dv">7</span>)<span class="kw">-</span>co(<span class="dv">0</span>))<span class="kw">*</span>(OA(<span class="dv">0</span>)<span class="kw">*</span>ARA(<span class="dv">0</span>)<span class="kw">-</span>P(<span class="dv">3</span>)<span class="kw">*</span>OC(<span class="dv">0</span>)<span class="kw">*</span>CAL(<span class="dv">0</span><span class="co">))*(1-ph(0))/ph(0) </span></span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>                      Pe1<span class="kw">=</span>w(<span class="dv">0</span>)<span class="kw">*</span>P(<span class="dv">16</span>)<span class="kw">/</span>(<span class="dv">2</span><span class="kw">*</span>dca(<span class="dv">0</span>))</span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a>                      Pe2<span class="kw">=</span>w(<span class="dv">0</span>)<span class="kw">*</span>P(<span class="dv">16</span>)<span class="kw">/</span>(<span class="dv">2</span><span class="kw">*</span>dco(<span class="dv">0</span>))</span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a>                      Pe3<span class="kw">=</span>w(<span class="dv">0</span>)<span class="kw">*</span>P(<span class="dv">16</span>)<span class="kw">/</span>(<span class="dv">2</span><span class="kw">*</span>P(<span class="dv">35</span>))</span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a>                      <span class="kw">if</span>(Pe1<span class="op">.gt.</span><span class="fl">0.</span>) <span class="kw">then</span></span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>                         sigca(<span class="dv">0</span>)<span class="kw">=</span>(<span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>Pe1))<span class="kw">/</span>(<span class="fl">1.</span><span class="kw">-</span><span class="bu">dexp</span>(<span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>Pe1))<span class="kw">-</span><span class="fl">1.</span><span class="co">/Pe1</span></span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a>                      <span class="kw">else</span></span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>                         sigca(<span class="dv">0</span>)<span class="kw">=</span>(<span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="dv">2</span><span class="kw">*</span>Pe1))<span class="kw">/</span>(<span class="kw">-</span><span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="dv">2</span><span class="kw">*</span>Pe1))<span class="kw">-</span><span class="fl">1.</span><span class="kw">/</span><span class="co">Pe1 </span></span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a>                      <span class="kw">endif</span>      </span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a>                      <span class="kw">if</span>(Pe2<span class="op">.gt.</span><span class="fl">0.</span>) <span class="kw">then</span></span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a>                         sigco(<span class="dv">0</span>)<span class="kw">=</span>(<span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>Pe2))<span class="kw">/</span>(<span class="fl">1.</span><span class="kw">-</span><span class="bu">dexp</span>(<span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>Pe2))<span class="kw">-</span><span class="fl">1.</span><span class="co">/Pe2</span></span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a>                      <span class="kw">else</span></span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a>                         sigco(<span class="dv">0</span>)<span class="kw">=</span>(<span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="dv">2</span><span class="kw">*</span>Pe2))<span class="kw">/</span>(<span class="kw">-</span><span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="dv">2</span><span class="kw">*</span>Pe2))<span class="kw">-</span><span class="fl">1.</span><span class="kw">/</span><span class="co">Pe2 </span></span>
<span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a>                      <span class="kw">endif</span>    </span>
<span id="cb5-114"><a href="#cb5-114" aria-hidden="true" tabindex="-1"></a>                      <span class="kw">if</span>(Pe3<span class="op">.gt.</span><span class="fl">0.</span>) <span class="kw">then</span></span>
<span id="cb5-115"><a href="#cb5-115" aria-hidden="true" tabindex="-1"></a>                         sigpo(<span class="dv">0</span>)<span class="kw">=</span>(<span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>Pe3))<span class="kw">/</span>(<span class="fl">1.</span><span class="kw">-</span><span class="bu">dexp</span>(<span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>Pe3))<span class="kw">-</span><span class="fl">1.</span><span class="co">/Pe3</span></span>
<span id="cb5-116"><a href="#cb5-116" aria-hidden="true" tabindex="-1"></a>                      <span class="kw">else</span></span>
<span id="cb5-117"><a href="#cb5-117" aria-hidden="true" tabindex="-1"></a>                         sigpo(<span class="dv">0</span>)<span class="kw">=</span>(<span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="dv">2</span><span class="kw">*</span>Pe3))<span class="kw">/</span>(<span class="kw">-</span><span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="dv">2</span><span class="kw">*</span>Pe3))<span class="kw">-</span><span class="fl">1.</span><span class="kw">/</span><span class="co">Pe3 </span></span>
<span id="cb5-118"><a href="#cb5-118" aria-hidden="true" tabindex="-1"></a>                      <span class="kw">endif</span>            </span>
<span id="cb5-119"><a href="#cb5-119" aria-hidden="true" tabindex="-1"></a> <span class="co">!  other reaction rates</span></span>
<span id="cb5-120"><a href="#cb5-120" aria-hidden="true" tabindex="-1"></a>             <span class="kw">if</span> (<span class="dv">1</span><span class="kw">-</span>ARA(<span class="dv">0</span>)<span class="kw">-</span>CAL(<span class="dv">0</span>)<span class="op">.lt.</span><span class="fl">1.d-70</span>)<span class="kw">then</span></span>
<span id="cb5-121"><a href="#cb5-121" aria-hidden="true" tabindex="-1"></a>               RAR(<span class="dv">0</span>)<span class="kw">=-</span>P(<span class="dv">4</span>)<span class="kw">*</span>P(<span class="dv">26</span>)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>CAL(<span class="dv">0</span>))<span class="kw">-</span>P(<span class="dv">26</span>)<span class="kw">*</span>OA(<span class="dv">0</span>)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>CAL(<span class="dv">0</span>))<span class="kw">*</span>CAL(<span class="co">0)-P(26)*P(3)*OC(0)*(1-CAL(0))*CAL(0)</span></span>
<span id="cb5-122"><a href="#cb5-122" aria-hidden="true" tabindex="-1"></a>               RCAL(<span class="dv">0</span>)<span class="kw">=</span>P(<span class="dv">4</span>)<span class="kw">*</span>P(<span class="dv">26</span>)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>CAL(<span class="dv">0</span>))<span class="kw">+</span>P(<span class="dv">3</span>)<span class="kw">*</span>P(<span class="dv">26</span>)<span class="kw">*</span>OC(<span class="dv">0</span>)<span class="kw">*</span>CAL(<span class="dv">0</span>)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span><span class="co">CAL(0))+P(26)*OA(0)*CAL(0)*(1-CAL(0))</span></span>
<span id="cb5-123"><a href="#cb5-123" aria-hidden="true" tabindex="-1"></a>               Rp(<span class="dv">0</span>)<span class="kw">=</span>P(<span class="dv">26</span>)<span class="kw">*</span>((<span class="dv">1</span><span class="kw">-</span>CAL(<span class="dv">0</span>))<span class="kw">*</span>OA(<span class="dv">0</span>)<span class="kw">-</span>P(<span class="dv">3</span>)<span class="kw">*</span>CAL(<span class="dv">0</span>)<span class="kw">*</span>OC(<span class="dv">0</span>))<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>ph(<span class="dv">0</span>)<span class="co">)</span></span>
<span id="cb5-124"><a href="#cb5-124" aria-hidden="true" tabindex="-1"></a>             <span class="kw">else</span></span>
<span id="cb5-125"><a href="#cb5-125" aria-hidden="true" tabindex="-1"></a>               RAR(<span class="dv">0</span>)<span class="kw">=-</span>P(<span class="dv">4</span>)<span class="kw">*</span>P(<span class="dv">26</span>)<span class="kw">*</span>ARA(<span class="dv">0</span>)<span class="kw">-</span>P(<span class="dv">26</span>)<span class="kw">*</span>OA(<span class="dv">0</span>)<span class="kw">*</span>ARA(<span class="dv">0</span>)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>ARA(<span class="dv">0</span>))<span class="kw">-</span>P<span class="co">(26)*P(3)*OC(0)*ARA(0)*CAL(0)</span></span>
<span id="cb5-126"><a href="#cb5-126" aria-hidden="true" tabindex="-1"></a>               RCAL(<span class="dv">0</span>)<span class="kw">=</span>P(<span class="dv">4</span>)<span class="kw">*</span>P(<span class="dv">26</span>)<span class="kw">*</span>ARA(<span class="dv">0</span>)<span class="kw">+</span>P(<span class="dv">3</span>)<span class="kw">*</span>P(<span class="dv">26</span>)<span class="kw">*</span>OC(<span class="dv">0</span>)<span class="kw">*</span>CAL(<span class="dv">0</span>)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>CAL(<span class="co">0))+P(26)*OA(0)*CAL(0)*ARA(0)</span></span>
<span id="cb5-127"><a href="#cb5-127" aria-hidden="true" tabindex="-1"></a>               Rp(<span class="dv">0</span>)<span class="kw">=</span>P(<span class="dv">26</span>)<span class="kw">*</span>(ARA(<span class="dv">0</span>)<span class="kw">*</span>OA(<span class="dv">0</span>)<span class="kw">-</span>P(<span class="dv">3</span>)<span class="kw">*</span>CAL(<span class="dv">0</span>)<span class="kw">*</span>OC(<span class="dv">0</span>))<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>ph(<span class="dv">0</span>))</span>
<span id="cb5-128"><a href="#cb5-128" aria-hidden="true" tabindex="-1"></a>            <span class="kw">endif</span>                       </span>
<span id="cb5-129"><a href="#cb5-129" aria-hidden="true" tabindex="-1"></a> <span class="co">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!                         </span></span>
<span id="cb5-130"><a href="#cb5-130" aria-hidden="true" tabindex="-1"></a>             <span class="kw">do</span> <span class="dv">82</span> i<span class="kw">=</span><span class="dv">1</span>,N</span>
<span id="cb5-131"><a href="#cb5-131" aria-hidden="true" tabindex="-1"></a><span class="co">!  supersaturations</span></span>
<span id="cb5-132"><a href="#cb5-132" aria-hidden="true" tabindex="-1"></a><span class="co">!                F=dexp(-(i*dx-xpeak)**2/(2*xwidth**2))</span></span>
<span id="cb5-133"><a href="#cb5-133" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span>(i<span class="op">.lt.</span>N) <span class="kw">then</span></span>
<span id="cb5-134"><a href="#cb5-134" aria-hidden="true" tabindex="-1"></a>                  dpdx<span class="kw">=</span>(ph(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">-</span>ph(i<span class="kw">-</span><span class="dv">1</span>))<span class="kw">/</span>(<span class="dv">2</span><span class="kw">*</span>dx)</span>
<span id="cb5-135"><a href="#cb5-135" aria-hidden="true" tabindex="-1"></a>                <span class="kw">else</span></span>
<span id="cb5-136"><a href="#cb5-136" aria-hidden="true" tabindex="-1"></a>                  dpdx<span class="kw">=</span>(ph(N)<span class="kw">-</span>ph(N<span class="kw">-</span><span class="dv">1</span>))<span class="kw">/</span>dx</span>
<span id="cb5-137"><a href="#cb5-137" aria-hidden="true" tabindex="-1"></a>                <span class="kw">endif</span>    </span>
<span id="cb5-138"><a href="#cb5-138" aria-hidden="true" tabindex="-1"></a>                  dpdx<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb5-139"><a href="#cb5-139" aria-hidden="true" tabindex="-1"></a>                F<span class="kw">=</span><span class="fl">1.0d0</span></span>
<span id="cb5-140"><a href="#cb5-140" aria-hidden="true" tabindex="-1"></a>                OA(i)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb5-141"><a href="#cb5-141" aria-hidden="true" tabindex="-1"></a>                sa<span class="kw">=</span><span class="dv">1</span><span class="kw">-</span>ca(i)<span class="kw">*</span>co(i)<span class="kw">*</span>P(<span class="dv">24</span>)</span>
<span id="cb5-142"><a href="#cb5-142" aria-hidden="true" tabindex="-1"></a>                 sc<span class="kw">=</span>ca(i)<span class="kw">*</span>co(i)<span class="kw">-</span><span class="dv">1</span></span>
<span id="cb5-143"><a href="#cb5-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-144"><a href="#cb5-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-145"><a href="#cb5-145" aria-hidden="true" tabindex="-1"></a>                <span class="kw">IF</span>( (i<span class="op">.gt.</span>idis)<span class="op">.and.</span> (i<span class="op">.lt.</span>idisf)) <span class="kw">then</span>        </span>
<span id="cb5-146"><a href="#cb5-146" aria-hidden="true" tabindex="-1"></a>                   <span class="kw">if</span> (sa<span class="op">.gt.</span><span class="fl">0.</span>) <span class="kw">then</span></span>
<span id="cb5-147"><a href="#cb5-147" aria-hidden="true" tabindex="-1"></a>                         OA(i)<span class="kw">=</span>F<span class="kw">*</span>sa<span class="kw">**</span>P(<span class="dv">1</span>)</span>
<span id="cb5-148"><a href="#cb5-148" aria-hidden="true" tabindex="-1"></a>                   <span class="kw">else</span></span>
<span id="cb5-149"><a href="#cb5-149" aria-hidden="true" tabindex="-1"></a>                         OA(i)<span class="kw">=-</span>F<span class="kw">*</span>(<span class="kw">-</span>sa)<span class="kw">**</span>P(<span class="dv">1</span>) </span>
<span id="cb5-150"><a href="#cb5-150" aria-hidden="true" tabindex="-1"></a>                         OA(i)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb5-151"><a href="#cb5-151" aria-hidden="true" tabindex="-1"></a>                   <span class="kw">endif</span>           </span>
<span id="cb5-152"><a href="#cb5-152" aria-hidden="true" tabindex="-1"></a>                <span class="kw">endif</span></span>
<span id="cb5-153"><a href="#cb5-153" aria-hidden="true" tabindex="-1"></a>                <span class="kw">IF</span>( (i<span class="op">.eq.</span>idis)<span class="op">.or.</span> (i<span class="op">.eq.</span>idisf)) <span class="kw">then</span></span>
<span id="cb5-154"><a href="#cb5-154" aria-hidden="true" tabindex="-1"></a>                   <span class="kw">if</span> (sa<span class="op">.gt.</span><span class="fl">0.</span>) <span class="kw">then</span> </span>
<span id="cb5-155"><a href="#cb5-155" aria-hidden="true" tabindex="-1"></a>                       OA(i)<span class="kw">=</span>sa<span class="kw">**</span>P(<span class="dv">1</span>)</span>
<span id="cb5-156"><a href="#cb5-156" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">else</span></span>
<span id="cb5-157"><a href="#cb5-157" aria-hidden="true" tabindex="-1"></a>                      OA(i)<span class="kw">=-</span>(<span class="kw">-</span>sa)<span class="kw">**</span>P(<span class="dv">1</span>)</span>
<span id="cb5-158"><a href="#cb5-158" aria-hidden="true" tabindex="-1"></a>                      OA(i)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb5-159"><a href="#cb5-159" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">endif</span>      </span>
<span id="cb5-160"><a href="#cb5-160" aria-hidden="true" tabindex="-1"></a>                <span class="kw">endif</span></span>
<span id="cb5-161"><a href="#cb5-161" aria-hidden="true" tabindex="-1"></a>                <span class="kw">IF</span>( (i<span class="op">.lt.</span>idis)<span class="op">.or.</span> (i<span class="op">.gt.</span>idisf)) <span class="kw">then</span> </span>
<span id="cb5-162"><a href="#cb5-162" aria-hidden="true" tabindex="-1"></a>                   <span class="kw">if</span> (sa<span class="op">.gt.</span><span class="fl">0.</span>) <span class="kw">then</span> </span>
<span id="cb5-163"><a href="#cb5-163" aria-hidden="true" tabindex="-1"></a>                       OA(i)<span class="kw">=</span><span class="fl">0.d0</span></span>
<span id="cb5-164"><a href="#cb5-164" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">else</span></span>
<span id="cb5-165"><a href="#cb5-165" aria-hidden="true" tabindex="-1"></a>                      OA(i)<span class="kw">=-</span>(<span class="kw">-</span>sa)<span class="kw">**</span>P(<span class="dv">1</span>)</span>
<span id="cb5-166"><a href="#cb5-166" aria-hidden="true" tabindex="-1"></a>                       OA(i)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb5-167"><a href="#cb5-167" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">endif</span>      </span>
<span id="cb5-168"><a href="#cb5-168" aria-hidden="true" tabindex="-1"></a>               <span class="kw">endif</span>       </span>
<span id="cb5-169"><a href="#cb5-169" aria-hidden="true" tabindex="-1"></a>              <span class="kw">if</span>((i<span class="op">.gt.</span>icem)<span class="op">.and.</span>(i<span class="op">.lt.</span>icemf)) <span class="kw">then</span>               </span>
<span id="cb5-170"><a href="#cb5-170" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> (sc<span class="op">.gt.</span><span class="fl">0.</span>) <span class="kw">then</span></span>
<span id="cb5-171"><a href="#cb5-171" aria-hidden="true" tabindex="-1"></a>                           OC(i)<span class="kw">=</span>sc<span class="kw">**</span>P(<span class="dv">2</span>)</span>
<span id="cb5-172"><a href="#cb5-172" aria-hidden="true" tabindex="-1"></a>                 <span class="kw">else</span></span>
<span id="cb5-173"><a href="#cb5-173" aria-hidden="true" tabindex="-1"></a>                           OC(i)<span class="kw">=-</span>(<span class="kw">-</span>sc)<span class="kw">**</span>P(<span class="dv">2</span>)</span>
<span id="cb5-174"><a href="#cb5-174" aria-hidden="true" tabindex="-1"></a>                           OC(i)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb5-175"><a href="#cb5-175" aria-hidden="true" tabindex="-1"></a>                 <span class="kw">end if</span></span>
<span id="cb5-176"><a href="#cb5-176" aria-hidden="true" tabindex="-1"></a>              <span class="kw">endif</span></span>
<span id="cb5-177"><a href="#cb5-177" aria-hidden="true" tabindex="-1"></a>              <span class="kw">if</span>((i<span class="op">.eq.</span>icem)<span class="op">.or.</span>(i<span class="op">.eq.</span>icemf)) <span class="kw">then</span>               </span>
<span id="cb5-178"><a href="#cb5-178" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> (sc<span class="op">.gt.</span><span class="fl">0.</span>) <span class="kw">then</span></span>
<span id="cb5-179"><a href="#cb5-179" aria-hidden="true" tabindex="-1"></a>                           OC(i)<span class="kw">=</span>sc<span class="kw">**</span>P(<span class="dv">2</span>)</span>
<span id="cb5-180"><a href="#cb5-180" aria-hidden="true" tabindex="-1"></a>                 <span class="kw">else</span></span>
<span id="cb5-181"><a href="#cb5-181" aria-hidden="true" tabindex="-1"></a>                           OC(i)<span class="kw">=-</span>(<span class="kw">-</span>sc)<span class="kw">**</span>P(<span class="dv">2</span>)</span>
<span id="cb5-182"><a href="#cb5-182" aria-hidden="true" tabindex="-1"></a>                           OC(i)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb5-183"><a href="#cb5-183" aria-hidden="true" tabindex="-1"></a>                 <span class="kw">end if</span></span>
<span id="cb5-184"><a href="#cb5-184" aria-hidden="true" tabindex="-1"></a>              <span class="kw">endif</span> </span>
<span id="cb5-185"><a href="#cb5-185" aria-hidden="true" tabindex="-1"></a>              <span class="kw">if</span>((i<span class="op">.lt.</span>icem)<span class="op">.or.</span>(i<span class="op">.gt.</span>icemf)) <span class="kw">then</span>               </span>
<span id="cb5-186"><a href="#cb5-186" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> (sc<span class="op">.gt.</span><span class="fl">0.</span>) <span class="kw">then</span></span>
<span id="cb5-187"><a href="#cb5-187" aria-hidden="true" tabindex="-1"></a>                           OC(i)<span class="kw">=</span><span class="fl">0.d0</span></span>
<span id="cb5-188"><a href="#cb5-188" aria-hidden="true" tabindex="-1"></a>                 <span class="kw">else</span></span>
<span id="cb5-189"><a href="#cb5-189" aria-hidden="true" tabindex="-1"></a>                           OC(i)<span class="kw">=-</span>(<span class="kw">-</span>sc)<span class="kw">**</span>P(<span class="dv">2</span>)</span>
<span id="cb5-190"><a href="#cb5-190" aria-hidden="true" tabindex="-1"></a>                           OC(i)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb5-191"><a href="#cb5-191" aria-hidden="true" tabindex="-1"></a>                 <span class="kw">end if</span></span>
<span id="cb5-192"><a href="#cb5-192" aria-hidden="true" tabindex="-1"></a>              <span class="kw">endif</span>        </span>
<span id="cb5-193"><a href="#cb5-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-194"><a href="#cb5-194" aria-hidden="true" tabindex="-1"></a><span class="co">! velocity</span></span>
<span id="cb5-195"><a href="#cb5-195" aria-hidden="true" tabindex="-1"></a>          <span class="kw">if</span> ((<span class="dv">1</span><span class="kw">-</span>ph(i))<span class="op">.le.</span><span class="fl">0.05</span>)  <span class="kw">then</span></span>
<span id="cb5-196"><a href="#cb5-196" aria-hidden="true" tabindex="-1"></a><span class="co">!          write(6,*) &#39;p&gt;0.95 for t,i&#39;,t,i                 </span></span>
<span id="cb5-197"><a href="#cb5-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-198"><a href="#cb5-198" aria-hidden="true" tabindex="-1"></a> <span class="co">! k *(1-p) actually                          </span></span>
<span id="cb5-199"><a href="#cb5-199" aria-hidden="true" tabindex="-1"></a>                           k(i)<span class="kw">=</span>betasV<span class="kw">*</span><span class="fl">10.</span><span class="kw">*</span>ph(i)<span class="kw">**</span><span class="dv">2</span></span>
<span id="cb5-200"><a href="#cb5-200" aria-hidden="true" tabindex="-1"></a>                           u(i)<span class="kw">=</span>k(i)<span class="kw">*</span>(rhosw0<span class="kw">-</span><span class="dv">1</span>)<span class="kw">+</span>P(<span class="dv">23</span>)<span class="kw">-</span>P(<span class="dv">13</span>)<span class="kw">*</span>k(<span class="dv">0</span>)</span>
<span id="cb5-201"><a href="#cb5-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-202"><a href="#cb5-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-203"><a href="#cb5-203" aria-hidden="true" tabindex="-1"></a> <span class="co">!  approx u(i)=S                          </span></span>
<span id="cb5-204"><a href="#cb5-204" aria-hidden="true" tabindex="-1"></a> <span class="co">!                          u(i)=P(23)</span></span>
<span id="cb5-205"><a href="#cb5-205" aria-hidden="true" tabindex="-1"></a>                           w(i)<span class="kw">=</span>u(i)<span class="kw">-</span>k(i)<span class="kw">*</span>(rhosw0<span class="kw">-</span><span class="dv">1</span>)<span class="kw">/</span>ph(i)</span>
<span id="cb5-206"><a href="#cb5-206" aria-hidden="true" tabindex="-1"></a> <span class="co">!                          w(i)=u(i)-k(i)*(rhosw0-1)/ph(i)*(1+dpdx*P(33)/(ph(i)-P(34)))</span></span>
<span id="cb5-207"><a href="#cb5-207" aria-hidden="true" tabindex="-1"></a> <span class="co">!</span></span>
<span id="cb5-208"><a href="#cb5-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-209"><a href="#cb5-209" aria-hidden="true" tabindex="-1"></a>  <span class="co">!                        </span></span>
<span id="cb5-210"><a href="#cb5-210" aria-hidden="true" tabindex="-1"></a> <span class="co">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!                          </span></span>
<span id="cb5-211"><a href="#cb5-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-212"><a href="#cb5-212" aria-hidden="true" tabindex="-1"></a>                           dca(i)<span class="kw">=</span><span class="fl">1.</span><span class="kw">/</span>(<span class="dv">1</span><span class="kw">-</span><span class="dv">2</span><span class="kw">*</span><span class="bu">dlog</span>(ph(i)))</span>
<span id="cb5-213"><a href="#cb5-213" aria-hidden="true" tabindex="-1"></a>                           dco(i)<span class="kw">=</span>dca(i)<span class="kw">*</span>P(<span class="dv">25</span>)</span>
<span id="cb5-214"><a href="#cb5-214" aria-hidden="true" tabindex="-1"></a>           Rca(i)<span class="kw">=</span>P(<span class="dv">26</span>)<span class="kw">*</span>(P(<span class="dv">6</span>)<span class="kw">/</span>P(<span class="dv">7</span>)<span class="kw">-</span>ca(i))<span class="kw">*</span>(OA(i)<span class="kw">*</span>ARA(i)<span class="kw">-</span>P(<span class="dv">3</span>)<span class="kw">*</span>OC(i)<span class="kw">*</span>CAL(i<span class="co">))*(1-ph(i))/ph(i) </span></span>
<span id="cb5-215"><a href="#cb5-215" aria-hidden="true" tabindex="-1"></a>           Rco(i)<span class="kw">=</span>P(<span class="dv">26</span>)<span class="kw">*</span>(P(<span class="dv">6</span>)<span class="kw">/</span>P(<span class="dv">7</span>)<span class="kw">-</span>co(i))<span class="kw">*</span>(OA(i)<span class="kw">*</span>ARA(i)<span class="kw">-</span>P(<span class="dv">3</span>)<span class="kw">*</span>OC(i)<span class="kw">*</span>CAL(i<span class="co">))*(1-ph(i))/ph(i) </span></span>
<span id="cb5-216"><a href="#cb5-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-217"><a href="#cb5-217" aria-hidden="true" tabindex="-1"></a>                      Pe1<span class="kw">=</span>w(i)<span class="kw">*</span>P(<span class="dv">16</span>)<span class="kw">/</span>(<span class="dv">2</span><span class="kw">*</span>dca(i))</span>
<span id="cb5-218"><a href="#cb5-218" aria-hidden="true" tabindex="-1"></a>                      Pe2<span class="kw">=</span>w(i)<span class="kw">*</span>P(<span class="dv">16</span>)<span class="kw">/</span>(<span class="dv">2</span><span class="kw">*</span>dco(i))</span>
<span id="cb5-219"><a href="#cb5-219" aria-hidden="true" tabindex="-1"></a>                      Pe3<span class="kw">=</span>w(i)<span class="kw">*</span>P(<span class="dv">16</span>)<span class="kw">/</span>(<span class="dv">2</span><span class="kw">*</span>P(<span class="dv">35</span>))</span>
<span id="cb5-220"><a href="#cb5-220" aria-hidden="true" tabindex="-1"></a>                      <span class="kw">if</span>(Pe1<span class="op">.gt.</span><span class="fl">0.</span>) <span class="kw">then</span></span>
<span id="cb5-221"><a href="#cb5-221" aria-hidden="true" tabindex="-1"></a>                         sigca(i)<span class="kw">=</span>(<span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>Pe1))<span class="kw">/</span>(<span class="fl">1.</span><span class="kw">-</span><span class="bu">dexp</span>(<span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>Pe1))<span class="kw">-</span><span class="fl">1.</span><span class="co">/Pe1</span></span>
<span id="cb5-222"><a href="#cb5-222" aria-hidden="true" tabindex="-1"></a>                      <span class="kw">else</span></span>
<span id="cb5-223"><a href="#cb5-223" aria-hidden="true" tabindex="-1"></a>                         sigca(i)<span class="kw">=</span>(<span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="dv">2</span><span class="kw">*</span>Pe1))<span class="kw">/</span>(<span class="kw">-</span><span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="dv">2</span><span class="kw">*</span>Pe1))<span class="kw">-</span><span class="fl">1.</span><span class="kw">/</span><span class="co">Pe1 </span></span>
<span id="cb5-224"><a href="#cb5-224" aria-hidden="true" tabindex="-1"></a>                      <span class="kw">endif</span>      </span>
<span id="cb5-225"><a href="#cb5-225" aria-hidden="true" tabindex="-1"></a>                      <span class="kw">if</span>(Pe2<span class="op">.gt.</span><span class="fl">0.</span>) <span class="kw">then</span></span>
<span id="cb5-226"><a href="#cb5-226" aria-hidden="true" tabindex="-1"></a>                         sigco(i)<span class="kw">=</span>(<span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>Pe2))<span class="kw">/</span>(<span class="fl">1.</span><span class="kw">-</span><span class="bu">dexp</span>(<span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>Pe2))<span class="kw">-</span><span class="fl">1.</span><span class="co">/Pe2</span></span>
<span id="cb5-227"><a href="#cb5-227" aria-hidden="true" tabindex="-1"></a>                      <span class="kw">else</span></span>
<span id="cb5-228"><a href="#cb5-228" aria-hidden="true" tabindex="-1"></a>                         sigco(i)<span class="kw">=</span>(<span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="dv">2</span><span class="kw">*</span>Pe2))<span class="kw">/</span>(<span class="kw">-</span><span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="dv">2</span><span class="kw">*</span>Pe2))<span class="kw">-</span><span class="fl">1.</span><span class="kw">/</span><span class="co">Pe2 </span></span>
<span id="cb5-229"><a href="#cb5-229" aria-hidden="true" tabindex="-1"></a>                      <span class="kw">endif</span> </span>
<span id="cb5-230"><a href="#cb5-230" aria-hidden="true" tabindex="-1"></a>                      <span class="kw">If</span> (Pe3<span class="op">.gt.</span><span class="fl">0.</span>) <span class="kw">then</span></span>
<span id="cb5-231"><a href="#cb5-231" aria-hidden="true" tabindex="-1"></a>                         sigpo(i)<span class="kw">=</span>(<span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>Pe3))<span class="kw">/</span>(<span class="fl">1.</span><span class="kw">-</span><span class="bu">dexp</span>(<span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>Pe3))<span class="kw">-</span><span class="fl">1.</span><span class="co">/Pe3</span></span>
<span id="cb5-232"><a href="#cb5-232" aria-hidden="true" tabindex="-1"></a>                      <span class="kw">else</span></span>
<span id="cb5-233"><a href="#cb5-233" aria-hidden="true" tabindex="-1"></a>                         sigpo(i)<span class="kw">=</span>(<span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="dv">2</span><span class="kw">*</span>Pe3))<span class="kw">/</span>(<span class="kw">-</span><span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="dv">2</span><span class="kw">*</span>Pe3))<span class="kw">-</span><span class="fl">1.</span><span class="kw">/</span><span class="co">Pe3 </span></span>
<span id="cb5-234"><a href="#cb5-234" aria-hidden="true" tabindex="-1"></a>                      <span class="kw">endif</span>            </span>
<span id="cb5-235"><a href="#cb5-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-236"><a href="#cb5-236" aria-hidden="true" tabindex="-1"></a>          <span class="kw">else</span></span>
<span id="cb5-237"><a href="#cb5-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-238"><a href="#cb5-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-239"><a href="#cb5-239" aria-hidden="true" tabindex="-1"></a>                     <span class="kw">if</span> (ph(i)<span class="op">.le.</span>P(<span class="dv">34</span>)) <span class="kw">THEN</span></span>
<span id="cb5-240"><a href="#cb5-240" aria-hidden="true" tabindex="-1"></a> <span class="co">!                write(6,*) &#39;phi = eps at i, t=&#39;,ph(i),i,t</span></span>
<span id="cb5-241"><a href="#cb5-241" aria-hidden="true" tabindex="-1"></a> <span class="co">!                pause</span></span>
<span id="cb5-242"><a href="#cb5-242" aria-hidden="true" tabindex="-1"></a>                       k(i)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb5-243"><a href="#cb5-243" aria-hidden="true" tabindex="-1"></a>                       dca(i)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb5-244"><a href="#cb5-244" aria-hidden="true" tabindex="-1"></a>                       dco(i)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb5-245"><a href="#cb5-245" aria-hidden="true" tabindex="-1"></a>                       Rca(i)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb5-246"><a href="#cb5-246" aria-hidden="true" tabindex="-1"></a>                       Rco(i)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb5-247"><a href="#cb5-247" aria-hidden="true" tabindex="-1"></a>                       u(i)<span class="kw">=</span>k(i)<span class="kw">*</span>(rhosw0<span class="kw">-</span><span class="dv">1</span>)<span class="kw">+</span>P(<span class="dv">23</span>)<span class="kw">-</span>P(<span class="dv">13</span>)<span class="kw">*</span>k(<span class="dv">0</span>)</span>
<span id="cb5-248"><a href="#cb5-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-249"><a href="#cb5-249" aria-hidden="true" tabindex="-1"></a> <span class="co">! approx  u(i)=S       </span></span>
<span id="cb5-250"><a href="#cb5-250" aria-hidden="true" tabindex="-1"></a>  <span class="co">!                     u(i)=P(23)             </span></span>
<span id="cb5-251"><a href="#cb5-251" aria-hidden="true" tabindex="-1"></a>                       w(i)<span class="kw">=</span>u(i)</span>
<span id="cb5-252"><a href="#cb5-252" aria-hidden="true" tabindex="-1"></a> <span class="co">!!!!!!!!!!!!!!!!!!                      </span></span>
<span id="cb5-253"><a href="#cb5-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-254"><a href="#cb5-254" aria-hidden="true" tabindex="-1"></a>                       <span class="kw">if</span>(w(i)<span class="op">.gt.</span><span class="fl">0.</span>) <span class="kw">then</span></span>
<span id="cb5-255"><a href="#cb5-255" aria-hidden="true" tabindex="-1"></a>                          sigca(i)<span class="kw">=</span><span class="fl">1.</span></span>
<span id="cb5-256"><a href="#cb5-256" aria-hidden="true" tabindex="-1"></a>                          sigco(i)<span class="kw">=</span><span class="fl">1.</span></span>
<span id="cb5-257"><a href="#cb5-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-258"><a href="#cb5-258" aria-hidden="true" tabindex="-1"></a>                       <span class="kw">else</span>  </span>
<span id="cb5-259"><a href="#cb5-259" aria-hidden="true" tabindex="-1"></a>                          sigca(i)<span class="kw">=-</span><span class="fl">1.</span></span>
<span id="cb5-260"><a href="#cb5-260" aria-hidden="true" tabindex="-1"></a>                          sigco(i)<span class="kw">=-</span><span class="fl">1.</span></span>
<span id="cb5-261"><a href="#cb5-261" aria-hidden="true" tabindex="-1"></a>                       <span class="kw">endif</span></span>
<span id="cb5-262"><a href="#cb5-262" aria-hidden="true" tabindex="-1"></a>                       <span class="kw">if</span>(w(i)<span class="op">.gt.</span><span class="fl">0.</span>) <span class="kw">then</span></span>
<span id="cb5-263"><a href="#cb5-263" aria-hidden="true" tabindex="-1"></a>                          sigpo(i)<span class="kw">=</span><span class="fl">1.</span></span>
<span id="cb5-264"><a href="#cb5-264" aria-hidden="true" tabindex="-1"></a>                       <span class="kw">else</span>  </span>
<span id="cb5-265"><a href="#cb5-265" aria-hidden="true" tabindex="-1"></a>                          sigpo(i)<span class="kw">=-</span><span class="fl">1.</span></span>
<span id="cb5-266"><a href="#cb5-266" aria-hidden="true" tabindex="-1"></a>                       <span class="kw">endif</span></span>
<span id="cb5-267"><a href="#cb5-267" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">else</span></span>
<span id="cb5-268"><a href="#cb5-268" aria-hidden="true" tabindex="-1"></a>                       k(i)<span class="kw">=</span>betasV<span class="kw">*</span>ph(i)<span class="kw">**</span><span class="dv">3</span><span class="kw">/</span>(<span class="dv">1</span><span class="kw">-</span>ph(i))</span>
<span id="cb5-269"><a href="#cb5-269" aria-hidden="true" tabindex="-1"></a>                       k(i)<span class="kw">=</span>k(i)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span><span class="bu">dexp</span>(<span class="kw">-</span><span class="fl">10.</span><span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>ph(i))<span class="kw">/</span>ph(i)))</span>
<span id="cb5-270"><a href="#cb5-270" aria-hidden="true" tabindex="-1"></a> <span class="co">! diffusion coefficient</span></span>
<span id="cb5-271"><a href="#cb5-271" aria-hidden="true" tabindex="-1"></a>                       dca(i)<span class="kw">=</span><span class="fl">1.</span><span class="kw">/</span>(<span class="dv">1</span><span class="kw">-</span><span class="dv">2</span><span class="kw">*</span><span class="bu">dlog</span>(ph(i)))</span>
<span id="cb5-272"><a href="#cb5-272" aria-hidden="true" tabindex="-1"></a>                       dco(i)<span class="kw">=</span>dca(i)<span class="kw">*</span>P(<span class="dv">25</span>)</span>
<span id="cb5-273"><a href="#cb5-273" aria-hidden="true" tabindex="-1"></a> <span class="co">! reaction rates </span></span>
<span id="cb5-274"><a href="#cb5-274" aria-hidden="true" tabindex="-1"></a>           Rca(i)<span class="kw">=</span>P(<span class="dv">26</span>)<span class="kw">*</span>(P(<span class="dv">6</span>)<span class="kw">/</span>P(<span class="dv">7</span>)<span class="kw">-</span>ca(i))<span class="kw">*</span>(OA(i)<span class="kw">*</span>ARA(i)<span class="kw">-</span>P(<span class="dv">3</span>)<span class="kw">*</span>OC(i)<span class="kw">*</span>CAL(i<span class="co">))*(1-ph(i))/ph(i) </span></span>
<span id="cb5-275"><a href="#cb5-275" aria-hidden="true" tabindex="-1"></a>           Rco(i)<span class="kw">=</span>P(<span class="dv">26</span>)<span class="kw">*</span>(P(<span class="dv">6</span>)<span class="kw">/</span>P(<span class="dv">7</span>)<span class="kw">-</span>co(i))<span class="kw">*</span>(OA(i)<span class="kw">*</span>ARA(i)<span class="kw">-</span>P(<span class="dv">3</span>)<span class="kw">*</span>OC(i)<span class="kw">*</span>CAL(i<span class="co">))*(1-ph(i))/ph(i) </span></span>
<span id="cb5-276"><a href="#cb5-276" aria-hidden="true" tabindex="-1"></a> <span class="co">!          write(13,*)i,Rca(i),Rco(i)</span></span>
<span id="cb5-277"><a href="#cb5-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-278"><a href="#cb5-278" aria-hidden="true" tabindex="-1"></a><span class="co">!  velocity u,w</span></span>
<span id="cb5-279"><a href="#cb5-279" aria-hidden="true" tabindex="-1"></a>                              u(i)<span class="kw">=</span>k(i)<span class="kw">*</span>(rhosw0<span class="kw">-</span><span class="dv">1</span>)<span class="kw">+</span>P(<span class="dv">23</span>)<span class="kw">-</span>P(<span class="dv">13</span>)<span class="kw">*</span>k(<span class="dv">0</span>)</span>
<span id="cb5-280"><a href="#cb5-280" aria-hidden="true" tabindex="-1"></a>                      w(i)<span class="kw">=</span>u(i)<span class="kw">-</span>k(i)<span class="kw">*</span>(rhosw0<span class="kw">-</span><span class="dv">1</span>)<span class="kw">/</span>ph(i)</span>
<span id="cb5-281"><a href="#cb5-281" aria-hidden="true" tabindex="-1"></a><span class="co">!  approx  u(i)=S               </span></span>
<span id="cb5-282"><a href="#cb5-282" aria-hidden="true" tabindex="-1"></a> <span class="co">!                     u(i)=P(23)     </span></span>
<span id="cb5-283"><a href="#cb5-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-284"><a href="#cb5-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-285"><a href="#cb5-285" aria-hidden="true" tabindex="-1"></a>                      w(i)<span class="kw">=</span>P(<span class="dv">23</span>)<span class="kw">-</span>k(i)<span class="kw">*</span>(rhosw0<span class="kw">-</span><span class="dv">1</span>)<span class="kw">/</span>ph(i)</span>
<span id="cb5-286"><a href="#cb5-286" aria-hidden="true" tabindex="-1"></a><span class="co">!                       w(i)=u(i)-k(i)*(rhosw0-1)/ph(i)*(1+dpdx*P(33)/(ph(i)-P(34)))</span></span>
<span id="cb5-287"><a href="#cb5-287" aria-hidden="true" tabindex="-1"></a>  <span class="co">!                    </span></span>
<span id="cb5-288"><a href="#cb5-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-289"><a href="#cb5-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-290"><a href="#cb5-290" aria-hidden="true" tabindex="-1"></a> <span class="co">!!!!!!!!!!!!!!!!!!!!                     </span></span>
<span id="cb5-291"><a href="#cb5-291" aria-hidden="true" tabindex="-1"></a>                      Pe1<span class="kw">=</span>w(i)<span class="kw">*</span>P(<span class="dv">16</span>)<span class="kw">/</span>(<span class="dv">2</span><span class="kw">*</span>dca(i))</span>
<span id="cb5-292"><a href="#cb5-292" aria-hidden="true" tabindex="-1"></a>                      Pe2<span class="kw">=</span>w(i)<span class="kw">*</span>P(<span class="dv">16</span>)<span class="kw">/</span>(<span class="dv">2</span><span class="kw">*</span>dco(i))</span>
<span id="cb5-293"><a href="#cb5-293" aria-hidden="true" tabindex="-1"></a>                      Pe3<span class="kw">=</span>w(i)<span class="kw">*</span>P(<span class="dv">16</span>)<span class="kw">/</span>(<span class="dv">2</span><span class="kw">*</span>P(<span class="dv">35</span>))</span>
<span id="cb5-294"><a href="#cb5-294" aria-hidden="true" tabindex="-1"></a>                      <span class="kw">if</span>(Pe1<span class="op">.gt.</span><span class="fl">0.</span>) <span class="kw">then</span></span>
<span id="cb5-295"><a href="#cb5-295" aria-hidden="true" tabindex="-1"></a>                         sigca(i)<span class="kw">=</span>(<span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>Pe1))<span class="kw">/</span>(<span class="fl">1.</span><span class="kw">-</span><span class="bu">dexp</span>(<span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>Pe1))<span class="kw">-</span><span class="fl">1.</span><span class="co">/Pe1</span></span>
<span id="cb5-296"><a href="#cb5-296" aria-hidden="true" tabindex="-1"></a>                      <span class="kw">else</span></span>
<span id="cb5-297"><a href="#cb5-297" aria-hidden="true" tabindex="-1"></a>                         sigca(i)<span class="kw">=</span>(<span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="dv">2</span><span class="kw">*</span>Pe1))<span class="kw">/</span>(<span class="kw">-</span><span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="dv">2</span><span class="kw">*</span>Pe1))<span class="kw">-</span><span class="fl">1.</span><span class="kw">/</span><span class="co">Pe1 </span></span>
<span id="cb5-298"><a href="#cb5-298" aria-hidden="true" tabindex="-1"></a>                      <span class="kw">endif</span>      </span>
<span id="cb5-299"><a href="#cb5-299" aria-hidden="true" tabindex="-1"></a>                      <span class="kw">if</span>(Pe2<span class="op">.gt.</span><span class="fl">0.</span>) <span class="kw">then</span></span>
<span id="cb5-300"><a href="#cb5-300" aria-hidden="true" tabindex="-1"></a>                         sigco(i)<span class="kw">=</span>(<span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>Pe2))<span class="kw">/</span>(<span class="fl">1.</span><span class="kw">-</span><span class="bu">dexp</span>(<span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>Pe2))<span class="kw">-</span><span class="fl">1.</span><span class="co">/Pe2</span></span>
<span id="cb5-301"><a href="#cb5-301" aria-hidden="true" tabindex="-1"></a>                      <span class="kw">else</span></span>
<span id="cb5-302"><a href="#cb5-302" aria-hidden="true" tabindex="-1"></a>                         sigco(i)<span class="kw">=</span>(<span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="dv">2</span><span class="kw">*</span>Pe2))<span class="kw">/</span>(<span class="kw">-</span><span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="dv">2</span><span class="kw">*</span>Pe2))<span class="kw">-</span><span class="fl">1.</span><span class="kw">/</span><span class="co">Pe2 </span></span>
<span id="cb5-303"><a href="#cb5-303" aria-hidden="true" tabindex="-1"></a>                      <span class="kw">endif</span> </span>
<span id="cb5-304"><a href="#cb5-304" aria-hidden="true" tabindex="-1"></a>                       <span class="kw">if</span>(Pe3<span class="op">.gt.</span><span class="fl">0.</span>) <span class="kw">then</span></span>
<span id="cb5-305"><a href="#cb5-305" aria-hidden="true" tabindex="-1"></a>                         sigpo(i)<span class="kw">=</span>(<span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>Pe3))<span class="kw">/</span>(<span class="fl">1.</span><span class="kw">-</span><span class="bu">dexp</span>(<span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>Pe3))<span class="kw">-</span><span class="fl">1.</span><span class="co">/Pe3</span></span>
<span id="cb5-306"><a href="#cb5-306" aria-hidden="true" tabindex="-1"></a>                      <span class="kw">else</span></span>
<span id="cb5-307"><a href="#cb5-307" aria-hidden="true" tabindex="-1"></a>                         sigpo(i)<span class="kw">=</span>(<span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="dv">2</span><span class="kw">*</span>Pe3))<span class="kw">/</span>(<span class="kw">-</span><span class="fl">1.</span><span class="kw">+</span><span class="bu">dexp</span>(<span class="dv">2</span><span class="kw">*</span>Pe3))<span class="kw">-</span><span class="fl">1.</span><span class="kw">/</span><span class="co">Pe3 </span></span>
<span id="cb5-308"><a href="#cb5-308" aria-hidden="true" tabindex="-1"></a>                      <span class="kw">endif</span>               </span>
<span id="cb5-309"><a href="#cb5-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-310"><a href="#cb5-310" aria-hidden="true" tabindex="-1"></a>              <span class="kw">endif</span>          </span>
<span id="cb5-311"><a href="#cb5-311" aria-hidden="true" tabindex="-1"></a>            <span class="kw">endif</span></span>
<span id="cb5-312"><a href="#cb5-312" aria-hidden="true" tabindex="-1"></a> <span class="co">!  other reaction rates</span></span>
<span id="cb5-313"><a href="#cb5-313" aria-hidden="true" tabindex="-1"></a>             <span class="kw">if</span> (<span class="dv">1</span><span class="kw">-</span>ARA(i)<span class="kw">-</span>CAL(i)<span class="op">.lt.</span><span class="fl">1.d-70</span>)<span class="kw">then</span></span>
<span id="cb5-314"><a href="#cb5-314" aria-hidden="true" tabindex="-1"></a>               RAR(i)<span class="kw">=-</span>P(<span class="dv">4</span>)<span class="kw">*</span>P(<span class="dv">26</span>)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>CAL(i))<span class="kw">-</span>P(<span class="dv">26</span>)<span class="kw">*</span>OA(i)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>CAL(i))<span class="kw">*</span>CAL(<span class="co">i)-P(26)*P(3)*OC(i)*(1-CAL(i))*CAL(i)</span></span>
<span id="cb5-315"><a href="#cb5-315" aria-hidden="true" tabindex="-1"></a>               RCAL(i)<span class="kw">=</span>P(<span class="dv">4</span>)<span class="kw">*</span>P(<span class="dv">26</span>)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>CAL(i))<span class="kw">+</span>P(<span class="dv">3</span>)<span class="kw">*</span>P(<span class="dv">26</span>)<span class="kw">*</span>OC(i)<span class="kw">*</span>CAL(i)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span><span class="co">CAL(i))+P(26)*OA(i)*CAL(i)*(1-CAL(i))</span></span>
<span id="cb5-316"><a href="#cb5-316" aria-hidden="true" tabindex="-1"></a>               Rp(i)<span class="kw">=</span>P(<span class="dv">26</span>)<span class="kw">*</span>((<span class="dv">1</span><span class="kw">-</span>CAL(i))<span class="kw">*</span>OA(i)<span class="kw">-</span>P(<span class="dv">3</span>)<span class="kw">*</span>CAL(i)<span class="kw">*</span>OC(i))<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>ph(i)<span class="co">)</span></span>
<span id="cb5-317"><a href="#cb5-317" aria-hidden="true" tabindex="-1"></a>             <span class="kw">else</span></span>
<span id="cb5-318"><a href="#cb5-318" aria-hidden="true" tabindex="-1"></a>               RAR(i)<span class="kw">=-</span>P(<span class="dv">4</span>)<span class="kw">*</span>P(<span class="dv">26</span>)<span class="kw">*</span>ARA(i)<span class="kw">-</span>P(<span class="dv">26</span>)<span class="kw">*</span>OA(i)<span class="kw">*</span>ARA(i)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>ARA(i))<span class="kw">-</span>P<span class="co">(26)*P(3)*OC(i)*ARA(i)*CAL(i)</span></span>
<span id="cb5-319"><a href="#cb5-319" aria-hidden="true" tabindex="-1"></a>               RCAL(i)<span class="kw">=</span>P(<span class="dv">4</span>)<span class="kw">*</span>P(<span class="dv">26</span>)<span class="kw">*</span>ARA(i)<span class="kw">+</span>P(<span class="dv">3</span>)<span class="kw">*</span>P(<span class="dv">26</span>)<span class="kw">*</span>OC(i)<span class="kw">*</span>CAL(i)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>CAL(<span class="co">i))+P(26)*OA(i)*CAL(i)*ARA(i)</span></span>
<span id="cb5-320"><a href="#cb5-320" aria-hidden="true" tabindex="-1"></a>               Rp(i)<span class="kw">=</span>P(<span class="dv">26</span>)<span class="kw">*</span>(ARA(i)<span class="kw">*</span>OA(i)<span class="kw">-</span>P(<span class="dv">3</span>)<span class="kw">*</span>CAL(i)<span class="kw">*</span>OC(i))<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>ph(i))</span>
<span id="cb5-321"><a href="#cb5-321" aria-hidden="true" tabindex="-1"></a>            <span class="kw">endif</span> </span>
<span id="cb5-322"><a href="#cb5-322" aria-hidden="true" tabindex="-1"></a><span class="co">! debug          </span></span>
<span id="cb5-323"><a href="#cb5-323" aria-hidden="true" tabindex="-1"></a><span class="co">!            u(i)=P(23)</span></span>
<span id="cb5-324"><a href="#cb5-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-325"><a href="#cb5-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-326"><a href="#cb5-326" aria-hidden="true" tabindex="-1"></a>            S(i)<span class="kw">=</span>u(i)<span class="kw">/</span><span class="bu">dabs</span>(u(i))                        </span>
<span id="cb5-327"><a href="#cb5-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-328"><a href="#cb5-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-329"><a href="#cb5-329" aria-hidden="true" tabindex="-1"></a><span class="dv">82</span>         <span class="kw">continue</span></span>
<span id="cb5-330"><a href="#cb5-330" aria-hidden="true" tabindex="-1"></a><span class="co">!           write (13,111) t,ph(N/4),k(N/4),u(N/4),w(N/4)</span></span>
<span id="cb5-331"><a href="#cb5-331" aria-hidden="true" tabindex="-1"></a><span class="co">!111        format (5(d12.5,1x))</span></span>
<span id="cb5-332"><a href="#cb5-332" aria-hidden="true" tabindex="-1"></a>           <span class="kw">return</span></span>
<span id="cb5-333"><a href="#cb5-333" aria-hidden="true" tabindex="-1"></a>           <span class="kw">end</span></span>
<span id="cb5-334"><a href="#cb5-334" aria-hidden="true" tabindex="-1"></a><span class="co">!</span></span></code></pre></div>
</div>
</section>
<section id="advanced-projection-method" class="level1">
<h1>Advanced projection method</h1>
<p>This routine calculates the projected solid phase fields at half-time in order to treat the non-linearities. This routine writes to <code>ARAhalf</code> and <code>CALhalf</code> variables. These are only used to compute the <code>cahalf</code>, <code>cohalf</code>, and <code>phalf</code> (corresponding to <span class="math inline">\(\phi\)</span>) later on.</p>
<p>Let <span class="math inline">\(a = \Delta t / 2\Delta x\)</span> be a prefactor, then for species <span class="math inline">\(k = {\rm Ara}, {\rm Cal}\)</span> compute the following,</p>
<p><span class="math display">\[k_{i + 1/2} = k_i - a u_i (k_i S_i - k_{i-1} {1 \over 2} (S_i + 1) + k_{i+1} {1 \over 2} (1 - S_i)) + {{\Delta t R^{k}_i} \over 2},\]</span></p>
<p>where <span class="math inline">\(S_i\)</span> is the sign of <span class="math inline">\(u_i\)</span>. This corresponds to an upwind scheme, basically evaluating Equations 40 and 41 from the paper at half-time.</p>
<div class="named-code-block">
<p>«project-x»</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode fortran"><code class="sourceCode fortranfixed"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">subroutine</span> projectX(n,ARA,CAL,U,S,RAR,RCAL,ARAhalf,CALhalf)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="dt">real*8</span> U(<span class="dv">0</span>:<span class="dv">1000</span>),ARA(<span class="dv">0</span>:<span class="dv">1000</span>),CAL(<span class="dv">0</span>:<span class="dv">1000</span>),ARAhalf(<span class="dv">0</span>:<span class="dv">1000</span>),CALhalf(<span class="dv">0</span>:<span class="dv">1000</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="dt">REAL*8</span> S(<span class="dv">0</span>:<span class="dv">1000</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="dt">REAL*8</span> dt,dx,P(<span class="dv">35</span>),a</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="dt">REAL*8</span> RAR(<span class="dv">0</span>:<span class="dv">1000</span>),RCAL(<span class="dv">0</span>:<span class="dv">1000</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="dt">integer</span> N,i</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">COMMON/par/P</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>dx<span class="kw">=</span>P(<span class="dv">16</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>dt<span class="kw">=</span>P(<span class="dv">15</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>a<span class="kw">=</span>dt<span class="kw">/</span>(<span class="dv">2</span><span class="kw">*</span>dx)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>ARAhalf(<span class="dv">0</span>)<span class="kw">=</span>ARA(<span class="dv">0</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">CALhalf(0)=CAL(0)</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="kw">do</span> i<span class="kw">=</span><span class="dv">1</span>,n<span class="kw">-</span><span class="dv">1</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="bu">     A</span>RAhalf(i)<span class="kw">=</span>ARA(i)<span class="kw">-</span>a<span class="kw">*</span>u(i)<span class="kw">*</span>(ARA(i)<span class="kw">*</span>S(i)<span class="kw">-</span>ARA(i<span class="kw">-</span><span class="dv">1</span>)<span class="kw">*</span><span class="fl">0.5</span><span class="kw">*</span>(S(i)<span class="kw">+</span><span class="fl">1.</span>)<span class="kw">&amp;</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>               <span class="kw">&amp;+</span>ARA(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">*</span><span class="fl">0.5</span><span class="kw">*</span>(<span class="fl">1.</span><span class="kw">-</span>S(i)))<span class="kw">+</span><span class="fl">0.5</span><span class="kw">*</span>dt<span class="kw">*</span>RAR(i)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="bu">     C</span>ALhalf(i)<span class="kw">=</span>CAL(i)<span class="kw">-</span>a<span class="kw">*</span>u(i)<span class="kw">*</span>(CAL(i)<span class="kw">*</span>S(i)<span class="kw">-</span>CAL(i<span class="kw">-</span><span class="dv">1</span>)<span class="kw">*</span><span class="fl">0.5</span><span class="kw">*</span>(S(i)<span class="kw">+</span><span class="fl">1.</span>)<span class="kw">&amp;</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>               <span class="kw">&amp;+</span>CAL(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">*</span><span class="fl">0.5</span><span class="kw">*</span>(<span class="fl">1.</span><span class="kw">-</span>S(i)))<span class="kw">+</span><span class="fl">0.5</span><span class="kw">*</span>dt<span class="kw">*</span>RCAL(i)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="bu">     &lt;</span><span class="op">&lt;</span>project<span class="kw">-</span>x<span class="kw">-</span>clamp<span class="kw">-</span>i<span class="op">&gt;&gt;</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="kw">end do</span> </span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>ARAhalf(n)<span class="kw">=</span>ARA(n)<span class="kw">-</span>a<span class="kw">*</span>u(n)<span class="kw">*</span>S(n)<span class="kw">*</span>(ARA(n)<span class="kw">-</span>ARA(n<span class="kw">-</span><span class="dv">1</span>))<span class="kw">+</span><span class="fl">0.5</span><span class="kw">*</span>dt<span class="kw">*</span>RAR(n)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="co">CALhalf(n)=CAL(n)-a*u(n)*S(n)*(CAL(n)-CAL(n-1))+0.5*dt*RCAL(n)</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>project<span class="kw">-</span>x<span class="kw">-</span>clamp<span class="kw">-</span>n<span class="op">&gt;&gt;</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="kw">return</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</div>
<p>In this routine, the output is clamped to values between 0 and 1.</p>
<div class="named-code-block">
<p>«project-x-clamp-i»</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode fortran"><code class="sourceCode fortranfixed"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span>(<span class="dv">1</span><span class="kw">-</span>ARAhalf(i)<span class="kw">-</span>CALhalf(i)<span class="op">.lt.</span><span class="fl">1.d-70</span>) ARAhalf(i)<span class="kw">=</span><span class="dv">1</span><span class="kw">-</span>CALhalf(i)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span>(<span class="dv">1</span><span class="kw">-</span>CALhalf(i)<span class="op">.lt.</span><span class="fl">1.d-10</span>) CALhalf(i)<span class="kw">=</span><span class="fl">1.</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span>(<span class="dv">1</span><span class="kw">-</span>ARAhalf(i)<span class="op">.lt.</span><span class="fl">1.d-10</span>) ARAhalf(i)<span class="kw">=</span><span class="fl">1.</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span>(ARAhalf(i)<span class="op">.lt.</span><span class="fl">1.d-70</span>) ARAhalf(i)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span>(CALhalf(i)<span class="op">.lt.</span><span class="fl">1.d-70</span>) CALhalf(i)<span class="kw">=</span><span class="fl">0.</span></span></code></pre></div>
</div>
<p>The last time is the same, just on index <code>n</code>.</p>
<p>The next routine calculates the projected aqueous phase fields at half-time in order to treat the non-linearities. This uses an upwind scheme for the advection and forward Euler for the diffusion part. I wonder how this affects the stability of the algorithm. Values of <span class="math inline">\(\phi_{i+1/2}\)</span> are again clamped to the open interval <span class="math inline">\((0, 1)\)</span>, staying a margin <span class="math inline">\(\epsilon\)</span> away from either 1 or 0 to avoid divisions by zero elsewhere in the code.</p>
<p>If <span class="math inline">\(\phi_i \le \epsilon\)</span>, the diffusion term in evaluating <span class="math inline">\(\partial_t \hat{c}_k\)</span> is dropped. Otherwise, we are looking at upwind for the advection part. The double derivative part:</p>
<p><span class="math display">\[\begin{align}
k_{i+1/2} &amp;= k_i - a w_i ((1-{\rm sig}k_i) k_{i+1} + 2({\rm sig}k_i)k_i - (1+{\rm sig} k_i)k_{i-1})\\
          &amp;+ {b \over \phi_i}(\phi_{i+1} d^k_{i+1} + \phi{i} d^k_{i})(k_{i+1} - k_{i})
           - {b \over \phi_i}(\phi_{i-1} d^k_{i-1} + \phi{i} d^k_{i})(k_{i} - k_{i-1})\\
          &amp;+ {\Delta t \over 2} R^k_{i}.
\end{align}\]</span></p>
<div class="named-code-block">
<p>«project-y»</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode fortran"><code class="sourceCode fortranfixed"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SUBROUTINE</span>  projectY(n,ph,ca,co,W,dca,dco,sigpo,sigca,sigco,Rp,Rca,Rco,phalf,cahalf,cohalf)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">real*8</span> ph(<span class="dv">0</span>:<span class="dv">1000</span>),W(<span class="dv">0</span>:<span class="dv">1000</span>),cahalf(<span class="dv">0</span>:<span class="dv">1000</span>),cohalf(<span class="dv">0</span>:<span class="dv">1000</span>),phalf(<span class="dv">0</span>:<span class="dv">1000</span>),sigpo(<span class="dv">0</span>:<span class="dv">1000</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">REAL*8</span> ca(<span class="dv">0</span>:<span class="dv">1000</span>),co(<span class="dv">0</span>:<span class="dv">1000</span>),dca(<span class="dv">0</span>:<span class="dv">1000</span>),dco(<span class="dv">0</span>:<span class="dv">1000</span>),sigca(<span class="dv">0</span>:<span class="dv">1000</span>),sigco(<span class="dv">0</span>:<span class="dv">1000</span>),Rca(<span class="dv">0</span>:<span class="dv">1000</span>),Rco(<span class="dv">0</span>:<span class="dv">1000</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">REAL*8</span> dt,dx,P(<span class="dv">35</span>),a,b,eps,difpor,Rp(<span class="dv">0</span>:<span class="dv">1000</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">integer</span> N,i</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">COMMON/</span>par<span class="kw">/</span>P</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    dx<span class="kw">=</span>P(<span class="dv">16</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    dt<span class="kw">=</span>P(<span class="dv">15</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    eps<span class="kw">=</span>P(<span class="dv">29</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    a<span class="kw">=</span>dt<span class="kw">/</span>(<span class="dv">4</span><span class="kw">*</span>dx)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    b<span class="kw">=</span>dt<span class="kw">/</span>(<span class="dv">4</span><span class="kw">*</span>dx<span class="kw">*</span>dx)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    difpor<span class="kw">=</span>P(<span class="dv">35</span>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    cahalf(<span class="dv">0</span>)<span class="kw">=</span>ca(<span class="dv">0</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    cohalf(<span class="dv">0</span>)<span class="kw">=</span>co(<span class="dv">0</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    phalf(<span class="dv">0</span>)<span class="kw">=</span>ph(<span class="dv">0</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">do</span> i<span class="kw">=</span><span class="dv">1</span>,n<span class="kw">-</span><span class="dv">1</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        phalf(i)<span class="kw">=</span>ph(i)<span class="kw">-</span>a<span class="kw">*</span>((<span class="dv">1</span><span class="kw">-</span>sigpo(i<span class="kw">+</span><span class="dv">1</span>))<span class="kw">*</span>ph(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">*</span>w(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">+</span><span class="dv">2</span><span class="kw">*</span>sigpo(i)<span class="kw">*</span>ph(i)<span class="co">*w(i)-&amp;</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>                <span class="kw">&amp;</span>(<span class="dv">1</span><span class="kw">+</span>sigpo(i<span class="kw">-</span><span class="dv">1</span>))<span class="kw">*</span>ph(i<span class="kw">-</span><span class="dv">1</span>)<span class="kw">*</span>w(i<span class="kw">-</span><span class="dv">1</span>))<span class="kw">&amp;</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>                <span class="kw">&amp;+</span><span class="dv">2</span><span class="kw">*</span>b<span class="kw">*</span>difpor<span class="kw">*</span>(ph(i<span class="kw">-</span><span class="dv">1</span>)<span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>ph(i)<span class="kw">+</span>ph(i<span class="kw">+</span><span class="dv">1</span>))<span class="kw">+</span><span class="fl">0.5</span><span class="kw">*</span>dt<span class="kw">*</span>Rp(i)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span>(phalf(i)<span class="op">.lt.</span>eps) phalf(i)<span class="kw">=</span>eps</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span>(<span class="dv">1</span><span class="kw">-</span>phalf(i)<span class="op">.lt.</span>eps) phalf(i)<span class="kw">=</span><span class="fl">1.</span><span class="kw">-</span>eps    </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span>(ph(i)<span class="op">.le.</span>eps) <span class="kw">then</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>            cahalf(i)<span class="kw">=</span>ca(i)<span class="kw">-</span>a<span class="kw">*</span>w(i)<span class="kw">*</span>((<span class="dv">1</span><span class="kw">-</span>sigca(i))<span class="kw">*</span>ca(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">+</span><span class="dv">2</span><span class="kw">*</span>sigca(i)<span class="kw">*</span>ca(i<span class="co">)-(1+sigca(i))*ca(i-1)) &amp;</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>                     <span class="kw">&amp;+</span><span class="fl">0.5</span><span class="kw">*</span>dt<span class="kw">*</span>Rca(i)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>            cohalf(i)<span class="kw">=</span>co(i)<span class="kw">-</span>a<span class="kw">*</span>w(i)<span class="kw">*</span>((<span class="dv">1</span><span class="kw">-</span>sigco(i))<span class="kw">*</span>co(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">+</span><span class="dv">2</span><span class="kw">*</span>sigco(i)<span class="kw">*</span>co(i<span class="co">)-(1+sigco(i))*co(i-1)) &amp;</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>                     <span class="kw">&amp;+</span><span class="fl">0.5</span><span class="kw">*</span>dt<span class="kw">*</span>Rco(i)</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>        <span class="kw">else</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>            cahalf(i)<span class="kw">=</span>ca(i)<span class="kw">-</span>a<span class="kw">*</span>w(i)<span class="kw">*</span>((<span class="dv">1</span><span class="kw">-</span>sigca(i))<span class="kw">*</span>ca(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">+</span><span class="dv">2</span><span class="kw">*</span>sigca(i)<span class="kw">*</span>ca(i<span class="co">)-(1+sigca(i))*ca(i-1)) &amp;</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>                     <span class="kw">&amp;+</span>b<span class="kw">*</span>(ph(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">*</span>dca(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">+</span>ph(i)<span class="kw">*</span>dca(i))<span class="kw">*</span>(ca(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">-</span>ca(i))<span class="co">/ph(i) &amp;</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>                     <span class="kw">&amp;-</span>b<span class="kw">*</span>(ph(i<span class="kw">-</span><span class="dv">1</span>)<span class="kw">*</span>dca(i<span class="kw">-</span><span class="dv">1</span>)<span class="kw">+</span>ph(i)<span class="kw">*</span>dca(i))<span class="kw">*</span>(ca(i)<span class="kw">-</span>ca(i<span class="kw">-</span><span class="dv">1</span>))<span class="co">/ph(i)+0.5*dt*Rca(i)</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>            cohalf(i)<span class="kw">=</span>co(i)<span class="kw">-</span>a<span class="kw">*</span>w(i)<span class="kw">*</span>((<span class="dv">1</span><span class="kw">-</span>sigco(i))<span class="kw">*</span>co(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">+</span><span class="dv">2</span><span class="kw">*</span>sigco(i)<span class="kw">*</span>co(i<span class="co">)-(1+sigco(i))*co(i-1)) &amp;</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>                     <span class="kw">&amp;+</span>b<span class="kw">*</span>(ph(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">*</span>dco(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">+</span>ph(i)<span class="kw">*</span>dco(i))<span class="kw">*</span>(co(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">-</span>co(i))<span class="co">/ph(i) &amp;</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>                     <span class="kw">&amp;-</span>b<span class="kw">*</span>(ph(i<span class="kw">-</span><span class="dv">1</span>)<span class="kw">*</span>dco(i<span class="kw">-</span><span class="dv">1</span>)<span class="kw">+</span>ph(i)<span class="kw">*</span>dco(i))<span class="kw">*</span>(co(i)<span class="kw">-</span>co(i<span class="kw">-</span><span class="dv">1</span>))<span class="co">/ph(i)+0.5*dt*Rco(i)</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>        <span class="kw">endif</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span>(cahalf(i)<span class="op">.lt.</span><span class="fl">1.d-15</span>) cahalf(i)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span>(cohalf(i)<span class="op">.lt.</span><span class="fl">1.d-15</span>) cohalf(i)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end do</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>    phalf(n)<span class="kw">=</span>ph(n)<span class="kw">+</span><span class="dv">2</span><span class="kw">*</span>a<span class="kw">*</span>(sigpo(n<span class="kw">-</span><span class="dv">1</span>)<span class="kw">*</span>ph(n<span class="kw">-</span><span class="dv">1</span>)<span class="kw">*</span>w(n<span class="kw">-</span><span class="dv">1</span>)<span class="kw">-</span>sigpo(n)<span class="kw">*</span>ph(n)<span class="kw">*</span>w(n)) <span class="kw">&amp;</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>            <span class="kw">&amp;+</span><span class="dv">4</span><span class="kw">*</span>b<span class="kw">*</span>difpor<span class="kw">*</span>(ph(n<span class="kw">-</span><span class="dv">1</span>)<span class="kw">-</span>ph(n))<span class="kw">+</span><span class="fl">0.5</span><span class="kw">*</span>dt<span class="kw">*</span>Rp(n)</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span>(phalf(n)<span class="op">.lt.</span>eps) phalf(n)<span class="kw">=</span>eps</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span>(<span class="dv">1</span><span class="kw">-</span>phalf(n)<span class="op">.lt.</span>eps) phalf(n)<span class="kw">=</span><span class="fl">1.</span><span class="kw">-</span>eps    </span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> (ph(n)<span class="op">.le.</span>eps) <span class="kw">then</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>        cahalf(n)<span class="kw">=</span>ca(n)<span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>a<span class="kw">*</span>w(n)<span class="kw">*</span>sigca(n)<span class="kw">*</span>(ca(n)<span class="kw">-</span>ca(n<span class="kw">-</span><span class="dv">1</span>)) <span class="kw">+</span><span class="fl">0.5</span><span class="kw">*</span>dt<span class="kw">*</span>Rca(n)</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>        cohalf(n)<span class="kw">=</span>co(n)<span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>a<span class="kw">*</span>w(n)<span class="kw">*</span>sigco(n)<span class="kw">*</span>(co(n)<span class="kw">-</span>co(n<span class="kw">-</span><span class="dv">1</span>)) <span class="kw">+</span><span class="fl">0.5</span><span class="kw">*</span>dt<span class="kw">*</span>Rco(n)</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span>  </span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>        cahalf(n)<span class="kw">=</span>ca(n)<span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>a<span class="kw">*</span>w(n)<span class="kw">*</span>sigca(n)<span class="kw">*</span>(ca(n)<span class="kw">-</span>ca(n<span class="kw">-</span><span class="dv">1</span>)) <span class="kw">&amp;</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>                 <span class="kw">&amp;+</span><span class="dv">2</span><span class="kw">*</span>b<span class="kw">*</span>(ph(n<span class="kw">-</span><span class="dv">1</span>)<span class="kw">*</span>dca(n<span class="kw">-</span><span class="dv">1</span>)<span class="kw">+</span>ph(n)<span class="kw">*</span>dca(n))<span class="kw">*</span>(ca(n<span class="kw">-</span><span class="dv">1</span>)<span class="kw">-</span>ca(n))<span class="kw">/</span>ph(n)<span class="kw">+</span><span class="fl">0.5</span><span class="kw">*</span>dt<span class="kw">*</span>Rca(n)</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>        cohalf(n)<span class="kw">=</span>co(n)<span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>a<span class="kw">*</span>w(n)<span class="kw">*</span>sigco(n)<span class="kw">*</span>(co(n)<span class="kw">-</span>co(n<span class="kw">-</span><span class="dv">1</span>)) <span class="kw">&amp;</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>                 <span class="kw">&amp;+</span><span class="dv">2</span><span class="kw">*</span>b<span class="kw">*</span>(ph(n<span class="kw">-</span><span class="dv">1</span>)<span class="kw">*</span>dco(n<span class="kw">-</span><span class="dv">1</span>)<span class="kw">+</span>ph(n)<span class="kw">*</span>dco(n))<span class="kw">*</span>(co(n<span class="kw">-</span><span class="dv">1</span>)<span class="kw">-</span>co(n))<span class="kw">/</span>ph(n)<span class="kw">+</span><span class="fl">0.5</span><span class="kw">*</span>dt<span class="kw">*</span>Rco(n)</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">endif</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span>(cahalf(n)<span class="op">.lt.</span><span class="fl">1.d-15</span>) cahalf(n)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span>(cohalf(n)<span class="op">.lt.</span><span class="fl">1.d-15</span>) cohalf(n)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</div>
</section>
<section id="upwind-scheme" class="level1">
<h1>Upwind scheme</h1>
<div class="named-code-block">
<p>«upwind»</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode fortran"><code class="sourceCode fortranfixed"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>           <span class="kw">subroutine</span> upwind(n,ARA,CAL,U,S,RAR,RCAL)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">! Implementation of the upwind scheme for the advection equations</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>           <span class="dt">real*8</span> U(<span class="dv">0</span>:<span class="dv">1000</span>),ARA(<span class="dv">0</span>:<span class="dv">1000</span>),CAL(<span class="dv">0</span>:<span class="dv">1000</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>           <span class="dt">REAL*8</span> RAR(<span class="dv">0</span>:<span class="dv">1000</span>),RCAL(<span class="dv">0</span>:<span class="dv">1000</span>),ARAnew(<span class="dv">0</span>:<span class="dv">1000</span>),CALnew(<span class="dv">0</span>:<span class="dv">1000</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>           <span class="dt">REAL*8</span> S(<span class="dv">0</span>:<span class="dv">1000</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>           <span class="dt">REAL*8</span> dt,dx,P(<span class="dv">35</span>),a</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>               <span class="dt">integer</span> N,i</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>           <span class="kw">COMMON/</span>par<span class="kw">/</span>P</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>           dx<span class="kw">=</span>P(<span class="dv">16</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>           dt<span class="kw">=</span>P(<span class="dv">15</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>           a<span class="kw">=</span>dt<span class="kw">/</span>dx</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>           ARAnew(<span class="dv">0</span>)<span class="kw">=</span>ARA(<span class="dv">0</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>           CALnew(<span class="dv">0</span>)<span class="kw">=</span>CAL(<span class="dv">0</span>)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>           <span class="kw">do</span> <span class="dv">30</span> i<span class="kw">=</span><span class="dv">1</span>,n<span class="kw">-</span><span class="dv">1</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>             ARANEW(i)<span class="kw">=</span>ARA(i)<span class="kw">-</span>a<span class="kw">*</span>u(i)<span class="kw">*</span>(ARA(i)<span class="kw">*</span>S(i)<span class="kw">-</span>ARA(i<span class="kw">-</span><span class="dv">1</span>)<span class="kw">*</span><span class="fl">0.5</span><span class="kw">*</span>(S(i)<span class="kw">+</span><span class="fl">1.</span>)<span class="co">+ARA(i+1)*0.5*(1.-S(i)))&amp;</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a> <span class="kw">&amp;</span>              <span class="kw">+</span>dt<span class="kw">*</span>RAR(i)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>             CALNEW(i)<span class="kw">=</span>CAL(i)<span class="kw">-</span>a<span class="kw">*</span>u(i)<span class="kw">*</span>(CAL(i)<span class="kw">*</span>S(i)<span class="kw">-</span>CAL(i<span class="kw">-</span><span class="dv">1</span>)<span class="kw">*</span><span class="fl">0.5</span><span class="kw">*</span>(S(i)<span class="kw">+</span><span class="fl">1.</span>)<span class="co">+CAL(i+1)*0.5*(1.-S(i)))&amp;</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a> <span class="kw">&amp;</span>               <span class="kw">+</span>dt<span class="kw">*</span>RCAL(i)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>             <span class="kw">if</span>(<span class="dv">1</span><span class="kw">-</span>ARAnew(i)<span class="kw">-</span>CALnew(i)<span class="op">.lt.</span><span class="fl">1.d-70</span>) ARAnew(i)<span class="kw">=</span><span class="dv">1</span><span class="kw">-</span>CALnew(i)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>             <span class="kw">if</span>(<span class="dv">1</span><span class="kw">-</span>CALnew(i)<span class="op">.lt.</span><span class="fl">1.d-10</span>) CALnew(i)<span class="kw">=</span><span class="fl">1.</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>             <span class="kw">if</span>(<span class="dv">1</span><span class="kw">-</span>ARAnew(i)<span class="op">.lt.</span><span class="fl">1.d-10</span>) ARAnew(i)<span class="kw">=</span><span class="fl">1.</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>             <span class="kw">if</span>(ARAnew(i)<span class="op">.lt.</span><span class="fl">1.d-70</span>) ARAnew(i)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>             <span class="kw">if</span>(CALnew(i)<span class="op">.lt.</span><span class="fl">1.d-70</span>) CALnew(i)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="dv">30</span>         <span class="kw">continue</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>             ARAnew(n)<span class="kw">=</span>ARA(n)<span class="kw">-</span>a<span class="kw">*</span>u(n)<span class="kw">*</span>S(n)<span class="kw">*</span>(ARA(n)<span class="kw">-</span>ARA(n<span class="kw">-</span><span class="dv">1</span>))<span class="kw">+</span>dt<span class="kw">*</span>RAR(n)</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>             CALnew(n)<span class="kw">=</span>CAL(n)<span class="kw">-</span>a<span class="kw">*</span>u(n)<span class="kw">*</span>S(n)<span class="kw">*</span>(CAL(n)<span class="kw">-</span>CAL(n<span class="kw">-</span><span class="dv">1</span>))<span class="kw">+</span>dt<span class="kw">*</span>RCAL(n)</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>             <span class="kw">if</span>(<span class="dv">1</span><span class="kw">-</span>ARAnew(n)<span class="kw">-</span>CALnew(n)<span class="op">.lt.</span><span class="fl">1.d-70</span>) ARAnew(n)<span class="kw">=</span><span class="dv">1</span><span class="kw">-</span>CALnew(n)</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>             <span class="kw">if</span>(<span class="dv">1</span><span class="kw">-</span>CALnew(n)<span class="op">.lt.</span><span class="fl">1.d-10</span>) CALnew(n)<span class="kw">=</span><span class="fl">1.</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>             <span class="kw">if</span>(<span class="dv">1</span><span class="kw">-</span>ARAnew(n)<span class="op">.lt.</span><span class="fl">1.d-10</span>) ARAnew(n)<span class="kw">=</span><span class="fl">1.</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>             <span class="kw">if</span>(ARAnew(n)<span class="op">.lt.</span><span class="fl">1.d-70</span>) ARAnew(n)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>             <span class="kw">if</span>(CALnew(n)<span class="op">.lt.</span><span class="fl">1.d-70</span>) CALnew(n)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a><span class="co">!    update</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>             <span class="kw">do</span> <span class="dv">44</span> i<span class="kw">=</span><span class="dv">0</span>,n</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>                ARA(i)<span class="kw">=</span>ARAnew(i)</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>                CAL(i)<span class="kw">=</span>CALnew(i)</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a><span class="dv">44</span>           <span class="kw">continue</span>                                 </span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>           <span class="kw">return</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>           <span class="kw">end</span></span></code></pre></div>
</div>
</section>
<section id="crank-nicolson" class="level1">
<h1>Crank-Nicolson</h1>
<div class="named-code-block">
<p>«crank-nicolson»</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode fortran"><code class="sourceCode fortranfixed"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>           <span class="kw">subroutine</span> CRANK(t,n,ph,ca,co,Whalf,dca,dco,sigpo,sigca,sigco<span class="co">,Rp,Rca,Rco,phalf)</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">! implementation of the Crank-Nicholson scheme for the advection-diffusion equations: X(n+1)=(A^-1).B.X(n)</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>           <span class="dt">real*8</span> ph(<span class="dv">0</span>:<span class="dv">1000</span>),ca(<span class="dv">0</span>:<span class="dv">1000</span>),co(<span class="dv">0</span>:<span class="dv">1000</span>),Whalf(<span class="dv">0</span>:<span class="dv">1000</span>),sigpo(<span class="dv">0</span><span class="co">:1000),phalf(0:1000)</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>           <span class="dt">REAL*8</span> dt,dx,P(<span class="dv">35</span>),sigca(<span class="dv">0</span>:<span class="dv">1000</span>),sigco(<span class="dv">0</span>:<span class="dv">1000</span>),dca(<span class="dv">0</span>:<span class="dv">1000</span>),dco(<span class="dv">0</span>:<span class="dv">1000</span>),Rca(<span class="dv">0</span>:<span class="dv">1000</span>),Rco(<span class="dv">0</span>:<span class="dv">1000</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>           <span class="dt">REAL*8</span> aA1(<span class="dv">0</span>:<span class="dv">1000</span>),bA1(<span class="dv">0</span>:<span class="dv">1000</span>),cA1(<span class="dv">0</span>:<span class="dv">1000</span>),aA2(<span class="dv">0</span>:<span class="dv">1000</span>),bA2(<span class="dv">0</span>:<span class="co">1000),cA2(0:1000),Byca(0:1000),Byco(0:1000)</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>           <span class="dt">REAL*8</span> aA3(<span class="dv">0</span>:<span class="dv">1000</span>),bA3(<span class="dv">0</span>:<span class="dv">1000</span>),cA3(<span class="dv">0</span>:<span class="dv">1000</span>),Bypo(<span class="dv">0</span>:<span class="dv">1000</span>),Rp(<span class="dv">0</span>:<span class="co">1000)</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>           <span class="dt">REAL*8</span> a,b,t,eps</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>           <span class="dt">integer</span> N,i</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>           <span class="kw">COMMON/</span>par<span class="kw">/</span>P</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>           dx<span class="kw">=</span>P(<span class="dv">16</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>           dt<span class="kw">=</span>P(<span class="dv">15</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>           eps<span class="kw">=</span>P(<span class="dv">29</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>           a<span class="kw">=</span>dt<span class="kw">/</span>(<span class="dv">4</span><span class="kw">*</span>dx)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>           b<span class="kw">=</span>dt<span class="kw">/</span>(<span class="dv">4</span><span class="kw">*</span>dx<span class="kw">*</span>dx)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>           <span class="kw">call</span> matA(n,a,b,phalf,whalf,sigpo,sigca,sigco,dca,dco,aA1,bA1<span class="co">,cA1,aA2,bA2,cA2,aA3,bA3,cA3)</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>           <span class="kw">call</span> matBy(n,dt,a,b,ph,ca,co,phalf,whalf,sigpo,sigca,sigco,dca,dco,Rp,Rca,Rco,Bypo,Byca,Byco)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a> <span class="co">!          if (t.gt.320.2) then</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a> <span class="co">!             WRITE(13,*) t,aA1(25),aA1(26),bA1(25),bA1(26),cA1(25),cA1(26)</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">!            WRITE(13,*) t,aA2(25),aA2(26),bA2(25),bA2(26),cA2(25),cA2(26)</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">!         endif</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co">!  find solution</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>          <span class="kw">call</span> tridag(t,n,aA1,bA1,cA1,Byca,ca)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>          <span class="kw">call</span> tridag(t,n,aA2,bA2,cA2,Byco,co)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>      <span class="kw">call</span> tridag(t,n,aA3,bA3,cA3,Bypo,ph)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>          <span class="kw">do</span> <span class="dv">30</span> i<span class="kw">=</span><span class="dv">0</span>,n</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>              <span class="kw">IF</span>(ca(i)<span class="op">.lt.</span><span class="fl">1.d-15</span>) ca(i) <span class="kw">=</span> <span class="fl">0.</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>              <span class="kw">IF</span>(co(i)<span class="op">.lt.</span><span class="fl">1.d-15</span>) co(i) <span class="kw">=</span> <span class="fl">0.</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>              <span class="kw">if</span>(ph(i)<span class="op">.lt.</span>eps) ph(i)<span class="kw">=</span>eps</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>             <span class="kw">if</span>(<span class="dv">1</span><span class="kw">-</span>ph(i)<span class="op">.lt.</span>eps) ph(i)<span class="kw">=</span><span class="fl">1.</span><span class="kw">-</span>eps    </span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="dv">30</span>        <span class="kw">continue</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>          <span class="kw">return</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>          <span class="kw">end</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  <span class="co">!</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>  <span class="co">!</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>  <span class="co">!</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>          <span class="kw">subroutine</span> matA(n,a,b,phalf,whalf,sigpo,sigca,sigco,dca,dco,aA1,bA1,cA1,aA2,bA2,cA2,aA3,bA3,cA3)</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a> <span class="co">! Determine the matrix elements of the tridiagonal matrix A in the Crank-Nicholson scheme</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>          <span class="dt">real*8</span> Whalf(<span class="dv">0</span>:<span class="dv">1000</span>),phalf(<span class="dv">0</span>:<span class="dv">1000</span>)</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>           <span class="dt">REAL*8</span> sigpo(<span class="dv">0</span>:<span class="dv">1000</span>),sigca(<span class="dv">0</span>:<span class="dv">1000</span>),sigco(<span class="dv">0</span>:<span class="dv">1000</span>),dca(<span class="dv">0</span>:<span class="dv">1000</span>),<span class="co">dco(0:1000)</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>           <span class="dt">REAL*8</span> aA1(<span class="dv">0</span>:<span class="dv">1000</span>),bA1(<span class="dv">0</span>:<span class="dv">1000</span>),cA1(<span class="dv">0</span>:<span class="dv">1000</span>),aA2(<span class="dv">0</span>:<span class="dv">1000</span>),bA2(<span class="dv">0</span>:<span class="co">1000),cA2(0:1000)</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>           <span class="dt">Real*8</span> aA3(<span class="dv">0</span>:<span class="dv">1000</span>),bA3(<span class="dv">0</span>:<span class="dv">1000</span>),cA3(<span class="dv">0</span>:<span class="dv">1000</span>)</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>           <span class="dt">REAL*8</span> a,b,eps,P(<span class="dv">35</span>),difpor</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>           <span class="dt">integer</span> N,i</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>           <span class="kw">common/</span>par<span class="kw">/</span>P</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>           eps<span class="kw">=</span>P(<span class="dv">29</span>)</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>           difpor<span class="kw">=</span>P(<span class="dv">35</span>)</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>           aA1(<span class="dv">0</span>)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>           bA1(<span class="dv">0</span>)<span class="kw">=</span><span class="fl">1.</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>           cA1(<span class="dv">0</span>)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>           aA2(<span class="dv">0</span>)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>           bA2(<span class="dv">0</span>)<span class="kw">=</span><span class="fl">1.</span></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>           cA2(<span class="dv">0</span>)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>           aA3(<span class="dv">0</span>)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>           bA3(<span class="dv">0</span>)<span class="kw">=</span><span class="fl">1.</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>           cA3(<span class="dv">0</span>)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>          <span class="kw">do</span> <span class="dv">10</span> i<span class="kw">=</span><span class="dv">1</span>,n<span class="kw">-</span><span class="dv">1</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>           aA3(i)<span class="kw">=-</span>a<span class="kw">*</span>whalf(i<span class="kw">-</span><span class="dv">1</span>)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">+</span>sigpo(i<span class="kw">-</span><span class="dv">1</span>))<span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>difpor<span class="kw">*</span>b</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>           bA3(i)<span class="kw">=</span><span class="fl">1.</span><span class="kw">+</span><span class="dv">2</span><span class="kw">*</span>a<span class="kw">*</span>whalf(i)<span class="kw">*</span>sigpo(i)<span class="kw">+</span><span class="dv">4</span><span class="kw">*</span>difpor<span class="kw">*</span>b</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>           cA3(i)<span class="kw">=</span>a<span class="kw">*</span>whalf(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>sigpo(i<span class="kw">+</span><span class="dv">1</span>))<span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>difpor<span class="kw">*</span>b</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a> <span class="co">!     </span></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>           <span class="kw">if</span> (phalf(i)<span class="op">.le.</span>eps) <span class="kw">then</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>           aA1(i)<span class="kw">=</span> <span class="kw">-</span>a<span class="kw">*</span>whalf(i)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">+</span>sigca(i))</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>           bA1(i)<span class="kw">=</span><span class="fl">1.</span><span class="kw">+</span>a<span class="kw">*</span><span class="dv">2</span><span class="kw">*</span>whalf(i)<span class="kw">*</span>sigca(i)</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>           cA1(i)<span class="kw">=</span>a<span class="kw">*</span>whalf(i)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>sigca(i))</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>           aA2(i)<span class="kw">=</span> <span class="kw">-</span>a<span class="kw">*</span>whalf(i)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">+</span>sigco(i))</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>           bA2(i)<span class="kw">=</span><span class="fl">1.</span><span class="kw">+</span>a<span class="kw">*</span><span class="dv">2</span><span class="kw">*</span>whalf(i)<span class="kw">*</span>sigco(i)</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>           cA2(i)<span class="kw">=</span> a<span class="kw">*</span>whalf(i)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>sigco(i))</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>           <span class="kw">else</span>  </span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>               aA1(i)<span class="kw">=</span> <span class="kw">-</span>a<span class="kw">*</span>whalf(i)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">+</span>sigca(i))<span class="kw">-</span>b<span class="kw">*</span>(dca(i<span class="kw">-</span><span class="dv">1</span>)<span class="kw">*</span>phalf(i<span class="kw">-</span><span class="dv">1</span>)<span class="kw">+</span>dca(i)<span class="kw">*</span>phalf(i))<span class="kw">/</span>phalf(i)</span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>           bA1(i)<span class="kw">=</span><span class="fl">1.</span><span class="kw">+</span>a<span class="kw">*</span><span class="dv">2</span><span class="kw">*</span>whalf(i)<span class="kw">*</span>sigca(i)<span class="kw">+</span>b<span class="kw">*</span>(<span class="dv">2</span><span class="kw">*</span>phalf(i)<span class="kw">*</span>dca(i)<span class="kw">+</span>phalf(i<span class="kw">+</span><span class="co">1)*dca(i+1)+phalf(i-1)*dca(i-1))/phalf(i)</span></span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>           cA1(i)<span class="kw">=</span>a<span class="kw">*</span>whalf(i)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>sigca(i))<span class="kw">-</span>b<span class="kw">*</span>(dca(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">*</span>phalf(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">+</span>dca(i)<span class="kw">*</span><span class="co">phalf(i))/phalf(i)</span></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>           aA2(i)<span class="kw">=</span> <span class="kw">-</span>a<span class="kw">*</span>whalf(i)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">+</span>sigco(i))<span class="kw">-</span>b<span class="kw">*</span>(dco(i<span class="kw">-</span><span class="dv">1</span>)<span class="kw">*</span>phalf(i<span class="kw">-</span><span class="dv">1</span>)<span class="kw">+</span>dco(i<span class="co">)*phalf(i))/phalf(i)</span></span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>           bA2(i)<span class="kw">=</span><span class="fl">1.</span><span class="kw">+</span>a<span class="kw">*</span><span class="dv">2</span><span class="kw">*</span>whalf(i)<span class="kw">*</span>sigco(i)<span class="kw">+</span>b<span class="kw">*</span>(<span class="dv">2</span><span class="kw">*</span>phalf(i)<span class="kw">*</span>dco(i)<span class="kw">+</span>phalf(i<span class="kw">+</span><span class="co">1)*dco(i+1)+phalf(i-1)*dco(i-1))/phalf(i)</span></span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>           cA2(i)<span class="kw">=</span> a<span class="kw">*</span>whalf(i)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>sigco(i))<span class="kw">-</span>b<span class="kw">*</span>(dco(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">*</span>phalf(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">+</span>dco(i)<span class="co">*phalf(i))/phalf(i)</span></span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>           <span class="kw">endif</span></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span>       <span class="kw">continue</span></span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>           aA3(n)<span class="kw">=-</span><span class="dv">2</span><span class="kw">*</span>a<span class="kw">*</span>whalf(n<span class="kw">-</span><span class="dv">1</span>)<span class="kw">*</span>sigpo(n<span class="kw">-</span><span class="dv">1</span>)<span class="kw">-</span><span class="dv">4</span><span class="kw">*</span>difpor<span class="kw">*</span>b</span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>           bA3(n)<span class="kw">=</span><span class="fl">1.</span><span class="kw">+</span><span class="dv">2</span><span class="kw">*</span>a<span class="kw">*</span>whalf(n)<span class="kw">*</span>sigpo(n)<span class="kw">+</span><span class="dv">4</span><span class="kw">*</span>difpor<span class="kw">*</span>b</span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>           cA3(n)<span class="kw">=</span><span class="fl">1.</span></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a> <span class="co">!          </span></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>           <span class="kw">if</span>(phalf(n)<span class="op">.le.</span>eps) <span class="kw">then</span></span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>           aA1(n)<span class="kw">=</span> <span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>a<span class="kw">*</span>whalf(n)<span class="kw">*</span>sigca(n)</span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>           bA1(n)<span class="kw">=</span><span class="fl">1.</span><span class="kw">+</span><span class="dv">2</span><span class="kw">*</span>a<span class="kw">*</span>whalf(n)<span class="kw">*</span>sigca(n)</span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>           cA1(n)<span class="kw">=</span><span class="fl">1.</span></span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a>           aA2(n)<span class="kw">=</span> <span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>a<span class="kw">*</span>whalf(n)<span class="kw">*</span>sigco(n)</span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a>           bA2(n)<span class="kw">=</span><span class="fl">1.</span><span class="kw">+</span><span class="dv">2</span><span class="kw">*</span>a<span class="kw">*</span>whalf(n)<span class="kw">*</span>sigco(n)</span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a>           cA2(n)<span class="kw">=</span><span class="fl">1.</span></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a>           <span class="kw">else</span></span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a>           aA1(n)<span class="kw">=</span> <span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>a<span class="kw">*</span>whalf(n)<span class="kw">*</span>sigca(n)<span class="kw">-</span>b<span class="kw">*</span>(dca(n<span class="kw">-</span><span class="dv">1</span>)<span class="kw">*</span>phalf(n<span class="kw">-</span><span class="dv">1</span>)<span class="kw">+</span><span class="dv">3</span><span class="kw">*</span>dca(n<span class="co">)*phalf(n))/phalf(n)</span></span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a>           bA1(n)<span class="kw">=</span><span class="fl">1.</span><span class="kw">+</span><span class="dv">2</span><span class="kw">*</span>a<span class="kw">*</span>whalf(n)<span class="kw">*</span>sigca(n)<span class="kw">+</span>b<span class="kw">*</span>(<span class="dv">3</span><span class="kw">*</span>dca(n)<span class="kw">*</span>phalf(n)<span class="kw">+</span>phalf(n<span class="kw">-</span><span class="co">1)*dca(n-1))/phalf(n)</span></span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a>           cA1(n)<span class="kw">=</span><span class="fl">1.</span></span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a>           aA2(n)<span class="kw">=</span> <span class="kw">-</span><span class="dv">2</span><span class="kw">*</span>a<span class="kw">*</span>whalf(n)<span class="kw">*</span>sigco(n)<span class="kw">-</span>b<span class="kw">*</span>(dco(n<span class="kw">-</span><span class="dv">1</span>)<span class="kw">*</span>phalf(n<span class="kw">-</span><span class="dv">1</span>)<span class="kw">+</span><span class="dv">3</span><span class="kw">*</span>dco(n<span class="co">)*phalf(n))/phalf(n)</span></span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a>           bA2(n)<span class="kw">=</span><span class="fl">1.</span><span class="kw">+</span><span class="dv">2</span><span class="kw">*</span>a<span class="kw">*</span>whalf(n)<span class="kw">*</span>sigco(n)<span class="kw">+</span>b<span class="kw">*</span>(<span class="dv">3</span><span class="kw">*</span>dco(n)<span class="kw">*</span>phalf(n)<span class="kw">+</span>phalf(n<span class="kw">-</span><span class="co">1)*dco(n-1))/phalf(n)</span></span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a>           cA2(n)<span class="kw">=</span><span class="fl">1.</span></span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a>           <span class="kw">endif</span></span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a>          <span class="kw">return</span></span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a>          <span class="kw">end</span></span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a><span class="co">!</span></span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a><span class="co">!</span></span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a>          <span class="kw">subroutine</span> matby(n,dt,a,b,ph,ca,co,phalf,whalf,sigpo,sigca,sigco,dca,dco,Rp,Rca,Rco,Bypo,Byca,Byco)</span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a><span class="co">! Determine the matrix elements of the tridiagonal matrix B in the Crank-Nicholson scheme</span></span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a>           <span class="dt">REAL*8</span> phalf(<span class="dv">0</span>:<span class="dv">1000</span>),whalf(<span class="dv">0</span>:<span class="dv">1000</span>),sigpo(<span class="dv">0</span>:<span class="dv">1000</span>), sigca(<span class="dv">0</span>:<span class="dv">1000</span>),sigco(<span class="dv">0</span>:<span class="dv">1000</span>),dca(<span class="dv">0</span>:<span class="dv">1000</span>)</span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a>       <span class="dt">REAL*8</span> dco(<span class="dv">0</span>:<span class="dv">1000</span>),Rca(<span class="dv">0</span>:<span class="dv">1000</span>),Rco(<span class="dv">0</span>:<span class="dv">1000</span>),Rp(<span class="dv">0</span>:<span class="dv">1000</span>)</span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a>           <span class="dt">REAL*8</span> Byca(<span class="dv">0</span>:<span class="dv">1000</span>),Byco(<span class="dv">0</span>:<span class="dv">1000</span>),Bypo(<span class="dv">0</span>:<span class="dv">1000</span>),co(<span class="dv">0</span>:<span class="dv">1000</span>),ca(<span class="dv">0</span><span class="co">:1000),ph(0:1000)</span></span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a>           <span class="dt">REAL*8</span> a,b,dt,P(<span class="dv">35</span>),eps,difpor</span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a>           <span class="dt">integer</span> N,i</span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a>           <span class="kw">common/</span>par<span class="kw">/</span>P</span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a>          eps<span class="kw">=</span>P(<span class="dv">29</span>)</span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a>          difpor<span class="kw">=</span>P(<span class="dv">35</span>)</span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a>          Byca(<span class="dv">0</span>)<span class="kw">=</span>ca(<span class="dv">0</span>)</span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a>          Byco(<span class="dv">0</span>)<span class="kw">=</span>co(<span class="dv">0</span>)</span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a>          Bypo(<span class="dv">0</span>)<span class="kw">=</span>ph(<span class="dv">0</span>)</span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-117"><a href="#cb10-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-118"><a href="#cb10-118" aria-hidden="true" tabindex="-1"></a>          <span class="kw">do</span> <span class="dv">10</span> i<span class="kw">=</span><span class="dv">1</span>,n<span class="kw">-</span><span class="dv">1</span></span>
<span id="cb10-119"><a href="#cb10-119" aria-hidden="true" tabindex="-1"></a>       Bypo(i)<span class="kw">=</span>(a<span class="kw">*</span>whalf(i<span class="kw">-</span><span class="dv">1</span>)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">+</span>sigpo(i<span class="kw">-</span><span class="dv">1</span>))<span class="kw">+</span><span class="dv">2</span><span class="kw">*</span>b<span class="kw">*</span>difpor)<span class="kw">*</span>ph(i<span class="kw">-</span><span class="dv">1</span>) <span class="kw">&amp;</span></span>
<span id="cb10-120"><a href="#cb10-120" aria-hidden="true" tabindex="-1"></a> <span class="kw">&amp;</span>             <span class="kw">+</span>(<span class="fl">1.</span><span class="kw">-</span>a<span class="kw">*</span><span class="dv">2</span><span class="kw">*</span>whalf(i)<span class="kw">*</span>sigpo(i)<span class="kw">-</span><span class="dv">4</span><span class="kw">*</span>b<span class="kw">*</span>difpor)<span class="kw">*</span>ph(i) <span class="kw">&amp;</span></span>
<span id="cb10-121"><a href="#cb10-121" aria-hidden="true" tabindex="-1"></a> <span class="kw">&amp;</span>             <span class="kw">+</span>  (<span class="kw">-</span>a<span class="kw">*</span>whalf(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>sigpo(i<span class="kw">+</span><span class="dv">1</span>))<span class="kw">+</span><span class="dv">2</span><span class="kw">*</span>b<span class="kw">*</span>difpor)<span class="kw">*</span>ph(i<span class="kw">+</span><span class="dv">1</span>) <span class="kw">+</span> dt<span class="co">*Rp(i)</span></span>
<span id="cb10-122"><a href="#cb10-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-123"><a href="#cb10-123" aria-hidden="true" tabindex="-1"></a> <span class="co">!</span></span>
<span id="cb10-124"><a href="#cb10-124" aria-hidden="true" tabindex="-1"></a>      <span class="kw">if</span>(phalf(i)<span class="op">.le.</span>eps) <span class="kw">then</span></span>
<span id="cb10-125"><a href="#cb10-125" aria-hidden="true" tabindex="-1"></a>        Byca(i)<span class="kw">=</span> (a<span class="kw">*</span>whalf(i)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">+</span>sigca(i)))<span class="kw">*</span>ca(i<span class="kw">-</span><span class="dv">1</span>) <span class="kw">&amp;</span></span>
<span id="cb10-126"><a href="#cb10-126" aria-hidden="true" tabindex="-1"></a> <span class="kw">&amp;</span>             <span class="kw">+</span>(<span class="fl">1.</span><span class="kw">-</span>a<span class="kw">*</span><span class="dv">2</span><span class="kw">*</span>whalf(i)<span class="kw">*</span>sigca(i))<span class="kw">*</span>ca(i) <span class="kw">&amp;</span></span>
<span id="cb10-127"><a href="#cb10-127" aria-hidden="true" tabindex="-1"></a> <span class="kw">&amp;</span>             <span class="kw">+</span>  (<span class="kw">-</span>a<span class="kw">*</span>whalf(i)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>sigca(i)))<span class="kw">*</span>ca(i<span class="kw">+</span><span class="dv">1</span>) <span class="kw">+</span> dt<span class="kw">*</span>Rca(i)</span>
<span id="cb10-128"><a href="#cb10-128" aria-hidden="true" tabindex="-1"></a>           Byco(i)<span class="kw">=</span>(a<span class="kw">*</span>whalf(i)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">+</span>sigco(i)))<span class="kw">*</span>co(i<span class="kw">-</span><span class="dv">1</span>) <span class="kw">&amp;</span></span>
<span id="cb10-129"><a href="#cb10-129" aria-hidden="true" tabindex="-1"></a> <span class="kw">&amp;</span>             <span class="kw">+</span>(<span class="fl">1.</span><span class="kw">-</span>a<span class="kw">*</span><span class="dv">2</span><span class="kw">*</span>whalf(i)<span class="kw">*</span>sigco(i))<span class="kw">*</span>co(i) <span class="kw">&amp;</span></span>
<span id="cb10-130"><a href="#cb10-130" aria-hidden="true" tabindex="-1"></a> <span class="kw">&amp;</span>             <span class="kw">+</span>  (<span class="kw">-</span>a<span class="kw">*</span>whalf(i)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>sigco(i)))<span class="kw">*</span>co(i<span class="kw">+</span><span class="dv">1</span>) <span class="kw">+</span> dt<span class="kw">*</span>Rco(i)</span>
<span id="cb10-131"><a href="#cb10-131" aria-hidden="true" tabindex="-1"></a>      <span class="kw">else</span> </span>
<span id="cb10-132"><a href="#cb10-132" aria-hidden="true" tabindex="-1"></a>           Byca(i)<span class="kw">=</span> (a<span class="kw">*</span>whalf(i)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">+</span>sigca(i))<span class="kw">+</span>b<span class="kw">*</span>(dca(i<span class="kw">-</span><span class="dv">1</span>)<span class="kw">*</span>phalf(i<span class="kw">-</span><span class="dv">1</span>)<span class="kw">+</span>dca(<span class="co">i)*phalf(i))/phalf(i))*ca(i-1) &amp;</span></span>
<span id="cb10-133"><a href="#cb10-133" aria-hidden="true" tabindex="-1"></a> <span class="kw">&amp;</span>             <span class="kw">+</span>(<span class="fl">1.</span><span class="kw">-</span>a<span class="kw">*</span><span class="dv">2</span><span class="kw">*</span>whalf(i)<span class="kw">*</span>sigca(i)<span class="kw">-</span>b<span class="kw">*</span>(<span class="dv">2</span><span class="kw">*</span>dca(i)<span class="kw">*</span>phalf(i)<span class="kw">+</span>dca(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">*</span><span class="co">phalf(i+1)+dca(i-1)*phalf(i-1))/phalf(i))*ca(i) &amp;</span></span>
<span id="cb10-134"><a href="#cb10-134" aria-hidden="true" tabindex="-1"></a> <span class="kw">&amp;</span>             <span class="kw">+</span>  (<span class="kw">-</span>a<span class="kw">*</span>whalf(i)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>sigca(i))<span class="kw">+</span>b<span class="kw">*</span>(dca(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">*</span>phalf(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">+</span>dca(i<span class="co">)*phalf(i))/phalf(i))*ca(i+1) + dt*Rca(i)</span></span>
<span id="cb10-135"><a href="#cb10-135" aria-hidden="true" tabindex="-1"></a>           Byco(i)<span class="kw">=</span>(a<span class="kw">*</span>whalf(i)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">+</span>sigco(i))<span class="kw">+</span>b<span class="kw">*</span>(dco(i<span class="kw">-</span><span class="dv">1</span>)<span class="kw">*</span>phalf(i<span class="kw">-</span><span class="dv">1</span>)<span class="kw">+</span>dco(i<span class="co">)*phalf(i))/phalf(i))*co(i-1) &amp;</span></span>
<span id="cb10-136"><a href="#cb10-136" aria-hidden="true" tabindex="-1"></a> <span class="kw">&amp;</span>             <span class="kw">+</span>(<span class="fl">1.</span><span class="kw">-</span>a<span class="kw">*</span><span class="dv">2</span><span class="kw">*</span>whalf(i)<span class="kw">*</span>sigco(i)<span class="kw">-</span>b<span class="kw">*</span>(<span class="dv">2</span><span class="kw">*</span>dco(i)<span class="kw">*</span>phalf(i)<span class="kw">+</span>dco(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">*</span><span class="co">phalf(i+1)+dco(i-1)*phalf(i-1))/phalf(i))*co(i) &amp;</span></span>
<span id="cb10-137"><a href="#cb10-137" aria-hidden="true" tabindex="-1"></a> <span class="kw">&amp;</span>             <span class="kw">+</span>  (<span class="kw">-</span>a<span class="kw">*</span>whalf(i)<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>sigco(i))<span class="kw">+</span>b<span class="kw">*</span>(dco(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">*</span>phalf(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">+</span>dco(i<span class="co">)*phalf(i))/phalf(i))*co(i+1) + dt*Rco(i)</span></span>
<span id="cb10-138"><a href="#cb10-138" aria-hidden="true" tabindex="-1"></a>         <span class="kw">endif</span></span>
<span id="cb10-139"><a href="#cb10-139" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span>       <span class="kw">continue</span></span>
<span id="cb10-140"><a href="#cb10-140" aria-hidden="true" tabindex="-1"></a>         Bypo(n)<span class="kw">=</span>(<span class="dv">2</span><span class="kw">*</span>a<span class="kw">*</span>whalf(n<span class="kw">-</span><span class="dv">1</span>)<span class="kw">*</span>sigpo(n<span class="kw">-</span><span class="dv">1</span>)<span class="kw">+</span><span class="dv">4</span><span class="kw">*</span>b<span class="kw">*</span>difpor)<span class="kw">*</span>ph(n<span class="kw">-</span><span class="dv">1</span>) <span class="kw">&amp;</span></span>
<span id="cb10-141"><a href="#cb10-141" aria-hidden="true" tabindex="-1"></a> <span class="kw">&amp;</span>             <span class="kw">+</span>(<span class="fl">1.</span><span class="kw">-</span>a<span class="kw">*</span><span class="dv">2</span><span class="kw">*</span>whalf(n)<span class="kw">*</span>sigpo(n)<span class="kw">-</span><span class="dv">4</span><span class="kw">*</span>b<span class="kw">*</span>difpor)<span class="kw">*</span>ph(n) <span class="kw">+</span> dt<span class="kw">*</span>Rp(n)</span>
<span id="cb10-142"><a href="#cb10-142" aria-hidden="true" tabindex="-1"></a><span class="co">!</span></span>
<span id="cb10-143"><a href="#cb10-143" aria-hidden="true" tabindex="-1"></a>         <span class="kw">if</span>(phalf(n)<span class="op">.le.</span>eps) <span class="kw">then</span></span>
<span id="cb10-144"><a href="#cb10-144" aria-hidden="true" tabindex="-1"></a>                    Byca(n)<span class="kw">=</span> <span class="dv">2</span><span class="kw">*</span>a<span class="kw">*</span>whalf(n)<span class="kw">*</span>sigca(n)<span class="kw">*</span>ca(n<span class="kw">-</span><span class="dv">1</span>) <span class="kw">&amp;</span></span>
<span id="cb10-145"><a href="#cb10-145" aria-hidden="true" tabindex="-1"></a> <span class="kw">&amp;</span>             <span class="kw">+</span>(<span class="fl">1.</span><span class="kw">-</span>a<span class="kw">*</span><span class="dv">2</span><span class="kw">*</span>whalf(n)<span class="kw">*</span>sigca(n))<span class="kw">*</span>ca(n)<span class="kw">+</span>dt<span class="kw">*</span>Rca(n)</span>
<span id="cb10-146"><a href="#cb10-146" aria-hidden="true" tabindex="-1"></a>            Byco(n)<span class="kw">=</span><span class="dv">2</span><span class="kw">*</span>a<span class="kw">*</span>whalf(n)<span class="kw">*</span>sigco(n)<span class="kw">*</span>co(n<span class="kw">-</span><span class="dv">1</span>) <span class="kw">&amp;</span></span>
<span id="cb10-147"><a href="#cb10-147" aria-hidden="true" tabindex="-1"></a> <span class="kw">&amp;</span>             <span class="kw">+</span>(<span class="fl">1.</span><span class="kw">-</span>a<span class="kw">*</span><span class="dv">2</span><span class="kw">*</span>whalf(n)<span class="kw">*</span>sigco(n))<span class="kw">*</span>co(n)<span class="kw">+</span>dt<span class="kw">*</span>Rco(n)</span>
<span id="cb10-148"><a href="#cb10-148" aria-hidden="true" tabindex="-1"></a>         <span class="kw">else</span>            </span>
<span id="cb10-149"><a href="#cb10-149" aria-hidden="true" tabindex="-1"></a>           Byca(n)<span class="kw">=</span> (<span class="dv">2</span><span class="kw">*</span>a<span class="kw">*</span>whalf(n)<span class="kw">*</span>sigca(n)<span class="kw">+</span>b<span class="kw">*</span>(dca(n<span class="kw">-</span><span class="dv">1</span>)<span class="kw">*</span>phalf(n<span class="kw">-</span><span class="dv">1</span>)<span class="kw">+</span><span class="dv">3</span><span class="kw">*</span>dca(<span class="co">n)*phalf(n))/phalf(n))*ca(n-1) &amp;</span></span>
<span id="cb10-150"><a href="#cb10-150" aria-hidden="true" tabindex="-1"></a> <span class="kw">&amp;</span>             <span class="kw">+</span>(<span class="fl">1.</span><span class="kw">-</span>a<span class="kw">*</span><span class="dv">2</span><span class="kw">*</span>whalf(n)<span class="kw">*</span>sigca(n)<span class="kw">-</span>b<span class="kw">*</span>(<span class="dv">3</span><span class="kw">*</span>dca(n)<span class="kw">*</span>phalf(n)<span class="kw">+</span>dca(n<span class="kw">-</span><span class="dv">1</span>)<span class="kw">*</span><span class="co">phalf(n-1))/phalf(n))*ca(n)+dt*Rca(n)</span></span>
<span id="cb10-151"><a href="#cb10-151" aria-hidden="true" tabindex="-1"></a>            Byco(n)<span class="kw">=</span>(<span class="dv">2</span><span class="kw">*</span>a<span class="kw">*</span>whalf(n)<span class="kw">*</span>sigco(n)<span class="kw">+</span>b<span class="kw">*</span>(dco(n<span class="kw">-</span><span class="dv">1</span>)<span class="kw">*</span>phalf(n<span class="kw">-</span><span class="dv">1</span>)<span class="kw">+</span><span class="dv">3</span><span class="kw">*</span>dco(<span class="co">n)*phalf(n))/phalf(n))*co(n-1) &amp;</span></span>
<span id="cb10-152"><a href="#cb10-152" aria-hidden="true" tabindex="-1"></a> <span class="kw">&amp;</span>             <span class="kw">+</span>(<span class="fl">1.</span><span class="kw">-</span>a<span class="kw">*</span><span class="dv">2</span><span class="kw">*</span>whalf(n)<span class="kw">*</span>sigco(n)<span class="kw">-</span>b<span class="kw">*</span>(<span class="dv">3</span><span class="kw">*</span>dco(n)<span class="kw">*</span>phalf(n)<span class="kw">+</span>dco(n<span class="kw">-</span><span class="dv">1</span>)<span class="kw">*</span><span class="co">phalf(n-1))/phalf(n))*co(n)+dt*Rco(n)</span></span>
<span id="cb10-153"><a href="#cb10-153" aria-hidden="true" tabindex="-1"></a>         <span class="kw">endif</span></span>
<span id="cb10-154"><a href="#cb10-154" aria-hidden="true" tabindex="-1"></a>         <span class="kw">return</span></span>
<span id="cb10-155"><a href="#cb10-155" aria-hidden="true" tabindex="-1"></a>          <span class="kw">end</span></span>
<span id="cb10-156"><a href="#cb10-156" aria-hidden="true" tabindex="-1"></a><span class="co">!</span></span>
<span id="cb10-157"><a href="#cb10-157" aria-hidden="true" tabindex="-1"></a><span class="co">!</span></span>
<span id="cb10-158"><a href="#cb10-158" aria-hidden="true" tabindex="-1"></a>        <span class="kw">subroutine</span> tridag(t,m,a,b,c,r,sol)</span>
<span id="cb10-159"><a href="#cb10-159" aria-hidden="true" tabindex="-1"></a><span class="co">! Find the inverse of the tridiagonal matrix A by Thomas algorithm</span></span>
<span id="cb10-160"><a href="#cb10-160" aria-hidden="true" tabindex="-1"></a>          <span class="kw">implicit</span> <span class="kw">none</span></span>
<span id="cb10-161"><a href="#cb10-161" aria-hidden="true" tabindex="-1"></a>          <span class="dt">real*8</span> a(<span class="dv">0</span>:<span class="dv">1000</span>),b(<span class="dv">0</span>:<span class="dv">1000</span>),c(<span class="dv">0</span>:<span class="dv">1000</span>),r(<span class="dv">0</span>:<span class="dv">1000</span>),sol(<span class="dv">0</span>:<span class="dv">1000</span>)</span>
<span id="cb10-162"><a href="#cb10-162" aria-hidden="true" tabindex="-1"></a>          <span class="dt">real*8</span> h(<span class="dv">0</span>:<span class="dv">1000</span>),g(<span class="dv">0</span>:<span class="dv">1000</span>),denom,t</span>
<span id="cb10-163"><a href="#cb10-163" aria-hidden="true" tabindex="-1"></a>          <span class="dt">INTEGER</span> m,i</span>
<span id="cb10-164"><a href="#cb10-164" aria-hidden="true" tabindex="-1"></a>          g(m<span class="kw">-</span><span class="dv">1</span>)<span class="kw">=-</span>a(m)<span class="kw">/</span>b(m)</span>
<span id="cb10-165"><a href="#cb10-165" aria-hidden="true" tabindex="-1"></a>          h(m<span class="kw">-</span><span class="dv">1</span>)<span class="kw">=</span>r(m)<span class="kw">/</span>b(m)</span>
<span id="cb10-166"><a href="#cb10-166" aria-hidden="true" tabindex="-1"></a>          <span class="kw">do</span> i<span class="kw">=</span>m<span class="kw">-</span><span class="dv">2</span>,<span class="dv">0</span>,<span class="kw">-</span><span class="dv">1</span></span>
<span id="cb10-167"><a href="#cb10-167" aria-hidden="true" tabindex="-1"></a>             denom<span class="kw">=</span>b(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">+</span>c(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">*</span>g(i<span class="kw">+</span><span class="dv">1</span>)</span>
<span id="cb10-168"><a href="#cb10-168" aria-hidden="true" tabindex="-1"></a>                 <span class="kw">if</span> (<span class="bu">dabs</span>(denom)<span class="op">.le.</span><span class="fl">1.d-70</span>) <span class="kw">then</span></span>
<span id="cb10-169"><a href="#cb10-169" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">write (</span><span class="dv">6</span>,<span class="fu">*)</span>  <span class="st">&#39;tridag a echoue a i et t=&#39;</span>,i,t</span>
<span id="cb10-170"><a href="#cb10-170" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">WRITE(</span><span class="dv">6</span>,<span class="fu">*)</span> <span class="st">&#39;denom,b,c,g=&#39;</span>,denom,b(i<span class="kw">+</span><span class="dv">2</span>),c(i<span class="kw">+</span><span class="dv">2</span>),g(i<span class="kw">+</span><span class="dv">2</span>)<span class="co">,b(i+1),c(i+1),g(i+1)</span></span>
<span id="cb10-171"><a href="#cb10-171" aria-hidden="true" tabindex="-1"></a>                 <span class="kw">endif</span>        </span>
<span id="cb10-172"><a href="#cb10-172" aria-hidden="true" tabindex="-1"></a>                 g(i)<span class="kw">=-</span>a(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">/</span>denom</span>
<span id="cb10-173"><a href="#cb10-173" aria-hidden="true" tabindex="-1"></a>                 h(i)<span class="kw">=</span>(r(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">-</span>c(i<span class="kw">+</span><span class="dv">1</span>)<span class="kw">*</span>h(i<span class="kw">+</span><span class="dv">1</span>))<span class="kw">/</span>denom</span>
<span id="cb10-174"><a href="#cb10-174" aria-hidden="true" tabindex="-1"></a>          <span class="kw">end do</span></span>
<span id="cb10-175"><a href="#cb10-175" aria-hidden="true" tabindex="-1"></a>          sol(<span class="dv">0</span>)<span class="kw">=</span>(r(<span class="dv">0</span>)<span class="kw">-</span>c(<span class="dv">0</span>)<span class="kw">*</span>h(<span class="dv">0</span>))<span class="kw">/</span>(b(<span class="dv">0</span>)<span class="kw">+</span>c(<span class="dv">0</span>)<span class="kw">*</span>g(<span class="dv">0</span>))</span>
<span id="cb10-176"><a href="#cb10-176" aria-hidden="true" tabindex="-1"></a>          <span class="kw">do</span> i<span class="kw">=</span><span class="dv">1</span>,m</span>
<span id="cb10-177"><a href="#cb10-177" aria-hidden="true" tabindex="-1"></a>            sol(i)<span class="kw">=</span>sol(i<span class="kw">-</span><span class="dv">1</span>)<span class="kw">*</span>g(i<span class="kw">-</span><span class="dv">1</span>)<span class="kw">+</span>h(i<span class="kw">-</span><span class="dv">1</span>)</span>
<span id="cb10-178"><a href="#cb10-178" aria-hidden="true" tabindex="-1"></a>          <span class="kw">end do</span></span>
<span id="cb10-179"><a href="#cb10-179" aria-hidden="true" tabindex="-1"></a>          <span class="kw">return</span></span>
<span id="cb10-180"><a href="#cb10-180" aria-hidden="true" tabindex="-1"></a>       <span class="kw">end</span></span></code></pre></div>
</div>
</section>
<section id="initialisation" class="level1">
<h1>Initialisation</h1>
<div class="named-code-block">
<p>«init»</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode fortran"><code class="sourceCode fortranfixed"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>       <span class="kw">subroutine</span> init</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">! This routine defines all parameter values and initial conditions, to be passed in vector P.</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>           <span class="kw">implicit</span> <span class="kw">none</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>           <span class="dt">real*8</span> pho(<span class="dv">0</span>:<span class="dv">1000</span>),cao(<span class="dv">0</span>:<span class="dv">1000</span>),coo(<span class="dv">0</span>:<span class="dv">1000</span>),ARAo(<span class="dv">0</span>:<span class="dv">1000</span>),CALo(<span class="co">0:1000)</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>           <span class="dt">REAL*8</span> dt,dx, P(<span class="dv">35</span>),Th,mua,rhoa,rhoc,rhot,rhow,D0ca,D0co3,Ka,<span class="co">Kc,beta,k1,k2,k3,length,xdis</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>           <span class="dt">REAL*8</span> m,nn,S,phi0,ca0,co30,ccal0,cara0,a,b,Vscale,rhos0,Xs,Ts,eps,xcem,xcemf</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>           <span class="dt">real*8</span> phi00,ca00,co300,ccal00,cara00,phiinf,cAthy</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">!           REAL*8 arg,tgh</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>           <span class="dt">integer</span> tmax,N,outt,i,outx</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>           <span class="kw">COMMON/</span>general<span class="kw">/</span> pho,cao,coo, ARAo,CALo,tmax,outx,outt, N</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>           <span class="kw">COMMON/</span>par<span class="kw">/</span>P</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">!   DIMENSIONLESS TIMES, tmax=max time index, outx = time index for graphic x output</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">!   outt= time index for graphic t outputs at four points</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">!  dt, dx = discrete steps (dimensionless) ; N +1 = total number of nodes;</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">! N must be a multiple of 4</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co">!  Th = thickness of active dissolution zone (cm); length = system size in cm, xdis=position of the beginning of the active dissolution zone (cm)</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co">! mua in g/mol, densities in g/cm3, diff (in pure water) in cm2/a, Ka, Kc in M2</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co">!</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co">! beta in cm/a, k1, k2,k3 in 1/a, m, n dimensionless</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="co">! S in cm/a, phio,cal0,cara0 dimensionless, ca0, co30 in M, a and b (tangh profile for initial concentrations) in cm</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co">! cAthy Athys constant in cm-1; phiinf=porosity at the bottom of the compressed system</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="co">!</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="co">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co">!           LAX=0</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>           dt<span class="kw">=</span><span class="fl">1.d-3</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>           dt<span class="kw">=</span><span class="fl">1.d-6</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a> <span class="co">!          length=2000.</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>           xdis<span class="kw">=</span><span class="fl">50.</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>           xcem<span class="kw">=-</span><span class="fl">100.</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>           xcemf<span class="kw">=</span><span class="fl">1000.</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>           length<span class="kw">=</span><span class="fl">500.</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>           Th<span class="kw">=</span><span class="fl">100.</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>           eps<span class="kw">=</span><span class="fl">1.d-2</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>           tmax<span class="kw">=</span><span class="dv">12</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>           outt<span class="kw">=</span><span class="dv">1</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>           outx<span class="kw">=</span>tmax<span class="kw">/</span><span class="dv">4</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>           N<span class="kw">=</span><span class="dv">200</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>           mua<span class="kw">=</span><span class="fl">100.09</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>           rhoa<span class="kw">=</span><span class="fl">2.95</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>           rhoc<span class="kw">=</span><span class="fl">2.71</span></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>           rhot<span class="kw">=</span><span class="fl">2.8</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>           rhow<span class="kw">=</span><span class="fl">1.023</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>           D0ca<span class="kw">=</span><span class="fl">131.9</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>           D0co3<span class="kw">=</span><span class="fl">272.6</span></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>           Ka<span class="kw">=</span><span class="fl">10.</span><span class="kw">**</span>(<span class="kw">-</span><span class="fl">6.19</span>)</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>           Kc<span class="kw">=</span><span class="fl">10.</span><span class="kw">**</span>(<span class="kw">-</span><span class="fl">6.37</span>)</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>           beta<span class="kw">=</span><span class="fl">0.01</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>           k1<span class="kw">=</span><span class="fl">0.0</span></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>           k2<span class="kw">=</span><span class="fl">1.d-2</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>           k3<span class="kw">=</span><span class="fl">1.d-3</span></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>           m<span class="kw">=</span><span class="fl">2.48</span></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>           nn<span class="kw">=</span><span class="fl">2.8</span></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a> <span class="co">!          m=1.</span></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>  <span class="co">!         nn=1.</span></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>           S<span class="kw">=</span><span class="fl">0.01</span></span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>           cAthy<span class="kw">=</span><span class="fl">0.1</span></span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a><span class="co">!           phiinf=0.05</span></span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>           phiinf<span class="kw">=</span><span class="fl">0.3</span></span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>           phiinf<span class="kw">=</span>eps</span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a><span class="co">!  new incoming sediment          </span></span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>            phi0<span class="kw">=</span><span class="fl">0.7</span> </span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>           ca0<span class="kw">=</span><span class="fl">0.5</span><span class="kw">*</span><span class="bu">dsqrt</span>(Kc)</span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>           co30<span class="kw">=</span><span class="fl">0.5</span><span class="kw">*</span><span class="bu">dsqrt</span>(Kc)</span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>           ccal0<span class="kw">=</span><span class="fl">0.3</span></span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>           cara0<span class="kw">=</span><span class="fl">0.6</span></span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a><span class="co">!  old uniform sediment</span></span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>           phi00<span class="kw">=</span><span class="fl">0.7</span></span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a>           ca00<span class="kw">=</span><span class="fl">0.5</span><span class="kw">*</span><span class="bu">dsqrt</span>(Kc)</span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a>           co300<span class="kw">=</span><span class="fl">0.5</span><span class="kw">*</span><span class="bu">dsqrt</span>(Kc)</span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>           ccal00<span class="kw">=</span><span class="fl">0.3</span></span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>           cara00<span class="kw">=</span><span class="fl">0.6</span>           </span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a>           a<span class="kw">=</span><span class="fl">0.7</span> <span class="kw">*</span>length</span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a>           b<span class="kw">=</span>length<span class="kw">/</span><span class="fl">10.</span></span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a><span class="co">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span></span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a> <span class="co">!          K0=beta*phi0**3/(1-phi0)**2</span></span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a> <span class="co">! Scale time with beta</span></span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>           Vscale<span class="kw">=</span>beta</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a> <span class="co">! Scale time with S   </span></span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>           Vscale<span class="kw">=</span>S</span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a>           rhos0<span class="kw">=</span>rhot<span class="kw">/</span>(<span class="dv">1</span><span class="kw">-</span>cara0<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>rhot<span class="kw">/</span>rhoa)<span class="kw">-</span>ccal0<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>rhot<span class="kw">/</span>rhoc))</span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a>           Xs<span class="kw">=</span>D0ca<span class="kw">/</span>Vscale</span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a>           Ts<span class="kw">=</span>D0ca<span class="kw">/</span>Vscale<span class="kw">/</span>Vscale</span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a>           dx<span class="kw">=</span>(length<span class="kw">/</span>Xs)<span class="kw">/</span>N</span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a><span class="co">!         </span></span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">1</span>)<span class="kw">=</span> m</span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">2</span>)<span class="kw">=</span> nn</span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">3</span>)<span class="kw">=</span> k3<span class="kw">/</span>k2</span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">4</span>)<span class="kw">=</span> k1<span class="kw">/</span>k2</span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">5</span>)<span class="kw">=</span>cara0<span class="kw">/</span>ccal0</span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">6</span>)<span class="kw">=</span> rhos0<span class="kw">*</span>ccal0<span class="kw">/</span>(mua<span class="kw">*</span><span class="bu">dsqrt</span>(Kc))</span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">7</span>)<span class="kw">=</span> rhos0<span class="kw">*</span>ccal0<span class="kw">/</span>rhoc</span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">8</span>)<span class="kw">=</span>phi0</span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">9</span>)<span class="kw">=</span> <span class="fl">1.</span><span class="kw">-</span>rhot<span class="kw">/</span>rhoc</span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">10</span>)<span class="kw">=</span> <span class="fl">1.</span><span class="kw">-</span>rhot<span class="kw">/</span>rhoa</span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">11</span>)<span class="kw">=</span> rhot<span class="kw">/</span>rhow</span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">12</span>)<span class="kw">=</span>rhoc<span class="kw">/</span>rhow</span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">13</span>)<span class="kw">=</span>rhos0<span class="kw">/</span>rhow<span class="kw">-</span><span class="fl">1.</span></span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">14</span>)<span class="kw">=</span>Th<span class="kw">/</span>Xs</span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">15</span>)<span class="kw">=</span>dt</span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">16</span>)<span class="kw">=</span>dx</span>
<span id="cb11-123"><a href="#cb11-123" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">17</span>)<span class="kw">=</span><span class="dv">1</span><span class="kw">-</span>cara0<span class="kw">-</span>ccal0</span>
<span id="cb11-124"><a href="#cb11-124" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">18</span>)<span class="kw">=</span>cara0</span>
<span id="cb11-125"><a href="#cb11-125" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">19</span>)<span class="kw">=</span>ccal0</span>
<span id="cb11-126"><a href="#cb11-126" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">20</span>)<span class="kw">=</span>rhos0<span class="kw">/</span>rhow</span>
<span id="cb11-127"><a href="#cb11-127" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">21</span>)<span class="kw">=</span>a<span class="kw">/</span>Xs</span>
<span id="cb11-128"><a href="#cb11-128" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">22</span>)<span class="kw">=</span>xdis<span class="kw">/</span>Xs</span>
<span id="cb11-129"><a href="#cb11-129" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">23</span>)<span class="kw">=</span>S<span class="kw">/</span>Vscale</span>
<span id="cb11-130"><a href="#cb11-130" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">24</span>)<span class="kw">=</span>Kc<span class="kw">/</span>Ka</span>
<span id="cb11-131"><a href="#cb11-131" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">25</span>)<span class="kw">=</span> D0co3<span class="kw">/</span>D0ca</span>
<span id="cb11-132"><a href="#cb11-132" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">26</span>)<span class="kw">=</span>k2<span class="kw">*</span>Ts</span>
<span id="cb11-133"><a href="#cb11-133" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">27</span>)<span class="kw">=</span>rhoc<span class="kw">/</span>rhoa</span>
<span id="cb11-134"><a href="#cb11-134" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">28</span>)<span class="kw">=</span>b<span class="kw">/</span>Xs</span>
<span id="cb11-135"><a href="#cb11-135" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">29</span>)<span class="kw">=</span>eps</span>
<span id="cb11-136"><a href="#cb11-136" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">30</span>)<span class="kw">=</span>xcem<span class="kw">/</span>Xs         </span>
<span id="cb11-137"><a href="#cb11-137" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">31</span>)<span class="kw">=</span>xcemf<span class="kw">/</span>Xs</span>
<span id="cb11-138"><a href="#cb11-138" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">32</span>)<span class="kw">=</span>beta<span class="kw">/</span>Vscale</span>
<span id="cb11-139"><a href="#cb11-139" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">33</span>)<span class="kw">=</span><span class="fl">1.</span><span class="kw">/</span>(cAthy<span class="kw">*</span>Xs)</span>
<span id="cb11-140"><a href="#cb11-140" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">34</span>)<span class="kw">=</span>phiinf</span>
<span id="cb11-141"><a href="#cb11-141" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">35</span>)<span class="kw">=</span>beta<span class="kw">*</span>phi0<span class="kw">**</span><span class="dv">3</span><span class="kw">/</span>((phi0<span class="kw">-</span>phiinf)<span class="kw">*</span>cAthy)<span class="kw">/</span>D0ca</span>
<span id="cb11-142"><a href="#cb11-142" aria-hidden="true" tabindex="-1"></a><span class="co">!  case where all densities are equal to rhos</span></span>
<span id="cb11-143"><a href="#cb11-143" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">7</span>)<span class="kw">=</span>ccal0</span>
<span id="cb11-144"><a href="#cb11-144" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">9</span>)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb11-145"><a href="#cb11-145" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">10</span>)<span class="kw">=</span><span class="fl">0.</span></span>
<span id="cb11-146"><a href="#cb11-146" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">11</span>)<span class="kw">=</span>rhos0<span class="kw">/</span>rhow</span>
<span id="cb11-147"><a href="#cb11-147" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">12</span>)<span class="kw">=</span>P(<span class="dv">11</span>)</span>
<span id="cb11-148"><a href="#cb11-148" aria-hidden="true" tabindex="-1"></a>           P(<span class="dv">27</span>)<span class="kw">=</span><span class="fl">1.</span>  </span>
<span id="cb11-149"><a href="#cb11-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-150"><a href="#cb11-150" aria-hidden="true" tabindex="-1"></a><span class="co">! Initial conditions (dimensionless)</span></span>
<span id="cb11-151"><a href="#cb11-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-152"><a href="#cb11-152" aria-hidden="true" tabindex="-1"></a>           pho(<span class="dv">0</span>)<span class="kw">=</span>phi0</span>
<span id="cb11-153"><a href="#cb11-153" aria-hidden="true" tabindex="-1"></a>           cao(<span class="dv">0</span>)<span class="kw">=</span>ca0<span class="kw">/</span><span class="bu">dsqrt</span>(Kc)</span>
<span id="cb11-154"><a href="#cb11-154" aria-hidden="true" tabindex="-1"></a>           coo(<span class="dv">0</span>)<span class="kw">=</span>co30<span class="kw">/</span><span class="bu">dsqrt</span>(Kc)</span>
<span id="cb11-155"><a href="#cb11-155" aria-hidden="true" tabindex="-1"></a>           ARAo(<span class="dv">0</span>)<span class="kw">=</span>cara0</span>
<span id="cb11-156"><a href="#cb11-156" aria-hidden="true" tabindex="-1"></a>           CALo(<span class="dv">0</span>)<span class="kw">=</span>ccal0</span>
<span id="cb11-157"><a href="#cb11-157" aria-hidden="true" tabindex="-1"></a>          <span class="kw">do</span> <span class="dv">10</span> i<span class="kw">=</span><span class="dv">1</span>,N</span>
<span id="cb11-158"><a href="#cb11-158" aria-hidden="true" tabindex="-1"></a>           pho(i)<span class="kw">=</span>phi00</span>
<span id="cb11-159"><a href="#cb11-159" aria-hidden="true" tabindex="-1"></a><span class="co">!           arg=(i*dx-P(21))/P(28)</span></span>
<span id="cb11-160"><a href="#cb11-160" aria-hidden="true" tabindex="-1"></a><span class="co">!               IF(arg.ge.0.) tgh=(1-dexp(-2*arg))/(1+dexp(-2*arg))</span></span>
<span id="cb11-161"><a href="#cb11-161" aria-hidden="true" tabindex="-1"></a><span class="co">!               IF(arg.lt.0.) tgh=(dexp(2*arg)-1)/(dexp(2*arg)+1)</span></span>
<span id="cb11-162"><a href="#cb11-162" aria-hidden="true" tabindex="-1"></a><span class="co">!           cao(i)=ca0/dsqrt(Kc)*0.5*(1-tgh)</span></span>
<span id="cb11-163"><a href="#cb11-163" aria-hidden="true" tabindex="-1"></a><span class="co">!           coo(i)=co30/dsqrt(Kc) *0.5*(1-tgh)</span></span>
<span id="cb11-164"><a href="#cb11-164" aria-hidden="true" tabindex="-1"></a>           cao(i)<span class="kw">=</span>ca00<span class="kw">/</span><span class="bu">dsqrt</span>(Kc)</span>
<span id="cb11-165"><a href="#cb11-165" aria-hidden="true" tabindex="-1"></a>           coo(i)<span class="kw">=</span>co300<span class="kw">/</span><span class="bu">dsqrt</span>(Kc)</span>
<span id="cb11-166"><a href="#cb11-166" aria-hidden="true" tabindex="-1"></a>           ARAo(i)<span class="kw">=</span>cara00</span>
<span id="cb11-167"><a href="#cb11-167" aria-hidden="true" tabindex="-1"></a>           CALo(i)<span class="kw">=</span>ccal00</span>
<span id="cb11-168"><a href="#cb11-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-169"><a href="#cb11-169" aria-hidden="true" tabindex="-1"></a> <span class="dv">10</span>     <span class="kw">continue</span></span>
<span id="cb11-170"><a href="#cb11-170" aria-hidden="true" tabindex="-1"></a><span class="co">!</span></span>
<span id="cb11-171"><a href="#cb11-171" aria-hidden="true" tabindex="-1"></a>           <span class="fu">write (</span><span class="dv">6</span>,<span class="fu">*)</span> <span class="st">&#39;Xs (cm), Ts (a)&#39;</span>, Xs,Ts</span>
<span id="cb11-172"><a href="#cb11-172" aria-hidden="true" tabindex="-1"></a>           <span class="fu">write (</span><span class="dv">6</span>,<span class="fu">*)</span> <span class="st">&#39;dt,dx,dtS/dx =&#39;</span>, dt,dx,P(<span class="dv">15</span>)<span class="kw">*</span>(P(<span class="dv">23</span>)<span class="kw">/</span>P(<span class="dv">16</span>))</span>
<span id="cb11-173"><a href="#cb11-173" aria-hidden="true" tabindex="-1"></a>           <span class="fu">WRITE(</span><span class="dv">6</span>,<span class="fu">*)</span> <span class="st">&#39;dx^2/2d=&#39;</span>, P(<span class="dv">16</span>)<span class="kw">**</span><span class="dv">2</span><span class="kw">/</span>(<span class="dv">2</span><span class="kw">*</span>P(<span class="dv">25</span>))</span>
<span id="cb11-174"><a href="#cb11-174" aria-hidden="true" tabindex="-1"></a>           <span class="kw">IF</span>(P(<span class="dv">15</span>)<span class="kw">*</span>P(<span class="dv">23</span>)<span class="kw">/</span>P(<span class="dv">16</span>)<span class="op">.gt.</span><span class="fl">1.</span><span class="kw">/</span><span class="fl">5.</span>) <span class="kw">then</span></span>
<span id="cb11-175"><a href="#cb11-175" aria-hidden="true" tabindex="-1"></a>              <span class="fu">WRITE(</span><span class="dv">6</span>,<span class="fu">*)</span><span class="st">&#39; problem: possible instability&#39;</span></span>
<span id="cb11-176"><a href="#cb11-176" aria-hidden="true" tabindex="-1"></a>           <span class="kw">endif</span></span>
<span id="cb11-177"><a href="#cb11-177" aria-hidden="true" tabindex="-1"></a>           <span class="fu">write (</span><span class="dv">6</span>,<span class="fu">*)</span> <span class="st">&#39;scale for MA, MC =&#39;</span>,rhos0<span class="kw">*</span>cara0<span class="kw">*</span>(<span class="dv">1</span><span class="kw">-</span>phi0), rhos0<span class="kw">*</span><span class="co">ccal0*(1-phi0)</span></span>
<span id="cb11-178"><a href="#cb11-178" aria-hidden="true" tabindex="-1"></a>           <span class="fu">write (</span><span class="dv">6</span>,<span class="fu">*)</span> <span class="st">&#39;scale for c=&#39;</span>,<span class="bu">dsqrt</span>(Kc)</span>
<span id="cb11-179"><a href="#cb11-179" aria-hidden="true" tabindex="-1"></a>           <span class="fu">write (</span><span class="dv">6</span>,<span class="fu">*)</span> <span class="st">&#39;Damkohler number Da=, scaled sedimentation rate,rhos0/rhow=&#39;</span>,P(<span class="dv">26</span>),P(<span class="dv">23</span>),rhos0<span class="kw">/</span>rhow</span>
<span id="cb11-180"><a href="#cb11-180" aria-hidden="true" tabindex="-1"></a>           <span class="fu">WRITE(</span><span class="dv">6</span>,<span class="fu">*)</span> <span class="st">&#39;scaled length, position of dissolution zone=&#39;</span>, length<span class="kw">/</span>Xs, xdis<span class="kw">/</span>Xs,(xdis<span class="kw">+</span>Th)<span class="kw">/</span>Xs</span>
<span id="cb11-181"><a href="#cb11-181" aria-hidden="true" tabindex="-1"></a>           <span class="fu">WRITE(</span><span class="dv">6</span>,<span class="fu">*)</span> <span class="st">&#39;a/Xs,b/Xs, rhosw-1=&#39;</span>,P(<span class="dv">21</span>),P(<span class="dv">28</span>),P(<span class="dv">13</span>)</span>
<span id="cb11-182"><a href="#cb11-182" aria-hidden="true" tabindex="-1"></a>           <span class="fu">write(</span><span class="dv">6</span>,<span class="fu">*)</span> <span class="st">&#39;1/cXs,Dpor/Dca=&#39;</span>,P(<span class="dv">33</span>),P(<span class="dv">35</span>)</span>
<span id="cb11-183"><a href="#cb11-183" aria-hidden="true" tabindex="-1"></a>       <span class="kw">return</span></span>
<span id="cb11-184"><a href="#cb11-184" aria-hidden="true" tabindex="-1"></a>       <span class="kw">end</span></span></code></pre></div>
</div>
</section>
        </div>
         <div class="col-3 col-s-3 menu" id="menu-container">
                <div id="menu"><nav id="TOC" role="doc-toc">
                                <ul>
                                <li><a href="#main">Main</a>
                                <ul>
                                <li><a href="#parameters-p35">Parameters <code>P(35)</code></a></li>
                                <li><a href="#integration">Integration</a></li>
                                </ul></li>
                                <li><a href="#auxiliary-functions">Auxiliary functions</a></li>
                                <li><a href="#advanced-projection-method">Advanced projection method</a></li>
                                <li><a href="#upwind-scheme">Upwind scheme</a></li>
                                <li><a href="#crank-nicolson">Crank-Nicolson</a></li>
                                <li><a href="#initialisation">Initialisation</a></li>
                                </ul>
                </nav></div>
        </div> 
</div>
<div class="footer">
</div>
<!-- <script>
function toggle_dark_mode() {
    var app = document.getElementsByTagName("BODY")[0];
    if (localStorage.darkMode == "dark") {
	localStorage.darkMode = "light";
	app.setAttribute("dark-mode", "light");
    } else {
	localStorage.darkMode = "dark";
	app.setAttribute("dark-mode", "dark");
    }
}
</script> -->
</body>
</html>
